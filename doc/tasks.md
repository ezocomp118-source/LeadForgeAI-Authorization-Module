# Чеклист по ТЗ (авторизация и профили)

## 1. Регистрация по приглашению
- [x] Схемы: приглашения с email/телефон/имя/фамилия + отдел/должность, токен, expiry.
- [x] API: выдача приглашения (админ/HR), приём токена → создание пользователя и membership.
- [x] Политика пароля (длина/энтропия) валидация на регистрации.
- [x] Верификация email/телефона в логике (флаги есть в схеме).

## 2. Дополнение профиля после регистрации
- [ ] Поля профиля: дата рождения, аватар, краткая инфо, мессенджеры (Telegram/WhatsApp) — эндпоинты/гварды.
- [ ] Требовать заполнение обязательных полей (если нужно).

## 3. Управление данными
- [ ] Пользователь редактирует: имя, фамилию, фото/аватар, мессенджеры, about — эндпоинты/гварды.
- [ ] Админ/HR редактирует: отдел, должность, рабочий email, служебный телефон — эндпоинты/гварды.
- [ ] Логирование критичных изменений (отдел/должность/рабочие контакты) — сервис/хуки + выдача аудита.

## 4. Аутентификация и сессии
- [x] Базовые маршруты: login/logout, `/api/auth/me`, session middleware.
- [ ] Персистентный стор сессий (Postgres), TTL/ротация.
- [ ] Защита от перебора/рейтк-лимит, 2FA по телефону (позже).
- [ ] Расширить `/api/auth/me`: возвращать членства/роли.

## 5. Оргструктура и доступ
- [ ] CRUD отделов/должностей (админ).
- [ ] CRUD членств с ролями (systemRole/projectRole в схеме); гварды на эндпоинты.

## 6. Безопасность и мониторинг сессий
- [ ] Сохранение телеметрии сессий (IP, UA, гео) в `sessions` при логине.
- [ ] Детект гео-аномалий (<6ч, разные города) → запись в `security_alerts`, уведомления админов.
- [ ] Админский список сессий и алертов (API/UI).

## 7. Учёт времени
- [ ] Эндпоинты старт/стоп смен, события активности/пауз → `time_entries`.
- [ ] Агрегации в `productivity_snapshots`, отчёты для пользователя и руководителей.

## 8. Swagger и DX
- [x] `/docs` для текущих auth endpoints.
- [ ] Обновлять `/docs` для profile/telemetry/time; прогон смоук в CI против dev БД.

## 9. Деплой и конфигурация
- [x] Централизованный `DEVELOPMENT_DATABASE_URL`, session secret env.
- [ ] Postgres session store, env для TTL/секретов, готовность окружений (k8s/pm2 и т.п.).
