import{r as o,a as i,s as l,h as w,c as _,p as S,d as h,i as u}from"./styles-Byh3MCSL.js";const d=e=>e instanceof HTMLDivElement,v=e=>e instanceof HTMLInputElement,L=e=>e instanceof HTMLFormElement,R=o("register-form",L),k=o("register-token",v),D=o("register-password",v),c=o("register-error",d),y=o("register-success",d),E=o("toast-root",d),I=e=>{if(!u(e))return null;const{id:s,email:t,firstName:n,lastName:r}=e;return[i(s??null),i(t??null),i(n??null),i(r??null)].every(Boolean)?{id:s,email:t,firstName:n,lastName:r}:null},P=e=>{if(!u(e))return null;const s=e.policy;if(!u(s))return null;const t=s,n=b=>{const f=t[b];return typeof f=="boolean"?f:null},r=n("tooShort"),a=n("missingLower"),p=n("missingUpper"),g=n("missingDigit"),m=n("missingSymbol");return r===null||a===null||p===null||g===null||m===null?null:{tooShort:r,missingLower:a,missingUpper:p,missingDigit:g,missingSymbol:m}},T=e=>{const s=P(e);if(!s)return"Password does not meet complexity rules.";const t=[];return s.tooShort&&t.push("min length 12"),s.missingLower&&t.push("lowercase letter"),s.missingUpper&&t.push("uppercase letter"),s.missingDigit&&t.push("digit"),s.missingSymbol&&t.push("symbol"),`Weak password: missing ${t.join(", ")}`},x=e=>{if(e._tag==="NetworkError")return`Network issue: ${e.reason}`;if(e._tag==="DecodeError")return`Response decode failed: ${e.reason}`;const s=e;return s.error==="invalid_payload"?"Please fill token and password.":s.error==="invitation_not_found_or_expired"?"Invitation not found or already expired.":s.error==="weak_password"?T(s.body):s.status===409&&s.error==="user_exists"?"User already exists for this invitation.":`API error ${s.status}: ${s.error}`},U=e=>typeof e=="object"&&e!==null&&"_tag"in e&&typeof e._tag=="string",$=e=>{e.preventDefault();const s=k.value.trim(),t=D.value;if(s.length===0||t.length===0){l(c,"Token and password are required.");return}l(c,null),w(y,!0),_(S("/api/auth/register",{token:s,password:t},I)).then(()=>{w(y,!1),h(E,"Registration successful","success"),window.setTimeout(()=>{window.location.href="/"},900)}).catch(n=>{const r=U(n)?x(n):"Unexpected error";l(c,r),h(E,r,"error")})},F=()=>{const e=new URLSearchParams(window.location.search).get("token");e&&i(e)&&(k.value=e)},H=()=>{F(),R.addEventListener("submit",$)};H();
