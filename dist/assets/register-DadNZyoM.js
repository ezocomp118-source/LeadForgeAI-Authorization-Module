import{l as x,n as b,q as S,u as g,i as m,j as r,r as c,a as j,k}from"./styles-T473Wog5.js";const y=e=>g(e)&&"policy"in e,v=e=>{if(!g(e))return null;const{id:s,email:t,firstName:i,lastName:n}=e;return m(s)&&m(t)&&m(i)&&m(n)?{id:s,email:t,firstName:i,lastName:n}:null},R=e=>{if(!y(e))return null;const s=e.policy;if(!g(s))return null;const t=d=>{const u=s[d];return typeof u=="boolean"?u:null},i=t("tooShort"),n=t("missingLower"),o=t("missingUpper"),a=t("missingDigit"),l=t("missingSymbol");return i===null||n===null||o===null||a===null||l===null?null:{tooShort:i,missingLower:n,missingUpper:o,missingDigit:a,missingSymbol:l}},E=e=>{const s=R(e);if(!s)return"Password does not meet complexity rules.";const t=[];return s.tooShort&&t.push("min length 12"),s.missingLower&&t.push("lowercase letter"),s.missingUpper&&t.push("uppercase letter"),s.missingDigit&&t.push("digit"),s.missingSymbol&&t.push("symbol"),`Weak password: missing ${t.join(", ")}`},N=e=>{const s=S(e);return s!==null?s:e._tag!=="ApiError"?"Unexpected error":e.error==="invalid_payload"?"Please fill token and password.":e.error==="invitation_not_found_or_expired"?"Invitation not found or already expired.":e.error==="weak_password"?E(e.body):e.status===409&&e.error==="user_exists"?"User already exists for this invitation.":`API error ${e.status}: ${e.error}`},P=e=>x(b("/api/auth/register",e,v),N),h=()=>{const e=new URLSearchParams(window.location.search).get("token");return m(e)?e.trim():""},T=()=>{window.setTimeout(()=>{window.location.href="/"},900)},U=()=>{const[e,s]=c.useState(null);return c.useEffect(()=>{if(!e)return;const i=window.setTimeout(()=>{s(null)},3200);return()=>{window.clearTimeout(i)}},[e]),{toast:e,push:(i,n)=>{s({message:i,tone:n})}}},_=({toast:e})=>e?r.jsx("div",{className:`toast ${e.tone}`,children:e.message}):null,C=()=>r.jsx("header",{className:"hero",style:{marginBottom:8},children:r.jsxs("div",{children:[r.jsx("p",{className:"eyebrow",children:"Authorization Module"}),r.jsx("h1",{children:"Complete registration"}),r.jsx("p",{className:"subtitle",children:"Use the invitation token you received to finish onboarding."})]})}),F=()=>{const[e,s]=c.useState({token:h(),password:""}),t=c.useMemo(()=>e.token.trim().length>0&&e.password.trim().length>0,[e.password,e.token]);c.useEffect(()=>{const n=h();n.length>0&&s(o=>({...o,token:n}))},[]);const i=c.useCallback((n,o)=>{s(a=>({...a,[n]:o}))},[]);return{form:e,setField:i,canSubmit:t}},A=e=>s=>{if(s.preventDefault(),!e.canSubmit){e.setError("Token and password are required.");return}e.setSubmitting(!0),e.setError(null),e.setSuccess(null),j(P({token:e.form.token.trim(),password:e.form.password})).then(t=>{if(e.setSubmitting(!1),t._tag==="Success"){e.setSuccess("Registration successful. Redirecting…"),e.push("Registration successful","success"),T();return}e.setError(t.error),e.push(t.error,"error")}).catch(()=>{e.setSubmitting(!1),e.setError("Unexpected error"),e.push("Unexpected error","error")})},I=()=>{const{form:e,setField:s,canSubmit:t}=F(),[i,n]=c.useState(!1),[o,a]=c.useState(null),[l,d]=c.useState(null),{toast:u,push:p}=U(),w=A({form:e,canSubmit:t,setSubmitting:n,setError:a,setSuccess:d,push:p});return{form:e,setField:s,submitting:i,error:o,success:l,toast:u,canSubmit:t,handleSubmit:w}},M=({form:e,onChange:s,onSubmit:t,disabled:i,submitting:n,error:o,success:a})=>r.jsxs("form",{className:"card",autoComplete:"off",onSubmit:t,children:[r.jsxs("label",{className:"full",children:[r.jsx("span",{children:"Invitation token"}),r.jsx("input",{name:"token",type:"text",value:e.token,onChange:l=>{s("token",l.target.value)},required:!0,placeholder:"paste token from invite"})]}),r.jsxs("label",{className:"full",children:[r.jsx("span",{children:"Create password"}),r.jsx("input",{name:"password",type:"password",value:e.password,onChange:l=>{s("password",l.target.value)},required:!0,placeholder:"Min 12 chars, upper/lower/digit/symbol"})]}),r.jsxs("div",{className:"stack full",children:[r.jsx("button",{className:"btn-primary",type:"submit",disabled:i,children:n?"Registering…":"Register"}),r.jsxs("span",{className:"muted",children:["Tokens from ",r.jsx("code",{children:"/register?token="})," links auto-fill above."]})]}),o&&r.jsx("div",{className:"error",children:o}),a&&r.jsx("div",{className:"success",children:a})]}),q=()=>{const{form:e,setField:s,submitting:t,error:i,success:n,toast:o,canSubmit:a,handleSubmit:l}=I(),d=(u,p)=>{s(u,p)};return r.jsxs("main",{className:"register-page",children:[r.jsx(C,{}),r.jsx(M,{form:e,onChange:d,onSubmit:l,disabled:!a||t,submitting:t,error:i,success:n}),r.jsx("div",{className:"notice",children:"Password policy: at least 12 characters including uppercase, lowercase, digit, and symbol."}),r.jsx(_,{toast:o})]})},f=document.getElementById("root");if(!f)throw new Error("Missing #root container for register app");k.createRoot(f).render(r.jsx(c.StrictMode,{children:r.jsx(q,{})}));
