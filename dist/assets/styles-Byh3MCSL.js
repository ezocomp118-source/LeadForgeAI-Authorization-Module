(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const il=t=>typeof t=="function",u=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(i){return e(i,n,r)}};case 4:return function(n,r,s,i){return arguments.length>=4?e(n,r,s,i):function(o){return e(o,n,r,s)}};case 5:return function(n,r,s,i,o){return arguments.length>=5?e(n,r,s,i,o):function(c){return e(c,n,r,s,i)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},U=t=>t,hr=t=>()=>t,Vi=hr(!0),Zr=hr(!1),Wo=hr(void 0),ol=Wo;function f(t,e,n,r,s,i,o,c,a){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return i(s(r(n(e(t)))));case 7:return o(i(s(r(n(e(t))))));case 8:return c(o(i(s(r(n(e(t)))))));case 9:return a(c(o(i(s(r(n(e(t))))))));default:{let l=arguments[0];for(let d=1;d<arguments.length;d++)l=arguments[d](l);return l}}}const Ls=t=>(e,n)=>e===n||t(e,n),cl=u(2,(t,e)=>Ls((n,r)=>t(e(n),e(r)))),al=t=>Ls((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),Ki="effect/GlobalValue";let Be;const R=(t,e)=>(Be||(globalThis[Ki]??=new Map,Be=globalThis[Ki]),Be.has(t)||Be.set(t,e()),Be.get(t)),ul=t=>typeof t=="string",ts=t=>typeof t=="number",ll=t=>typeof t=="bigint",dr=il,fl=t=>typeof t=="object"&&t!==null,pr=t=>fl(t)||dr(t),O=u(2,(t,e)=>pr(t)&&e in t),Yo=u(2,(t,e)=>O(t,"_tag")&&t._tag===e),ne=t=>t==null,hl=t=>O(t,"then")&&dr(t.then),gr=t=>`BUG: ${t} - please report an issue at https://github.com/Effect-TS/effect/issues`;let zo=class Qo{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new Qo(this.self)}};const dl=335903614,pl=4150755663,gl=1481765933,ml=1284865837,_l=9007199254740992,yl=134217728;class bl{_state;constructor(e,n,r,s){return ne(n)&&ne(e)?(n=Math.random()*4294967295>>>0,e=0):ne(n)&&(n=e,e=0),ne(s)&&ne(r)?(s=this._state?this._state[3]:pl,r=this._state?this._state[2]:dl):ne(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Ji(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*yl+n)/_l}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;Sl(this._state,e,n,gl,ml),Ji(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const i=(s>>>27|r<<5)>>>0,o=e>>>27,c=(-o>>>0&31)>>>0;return(i>>>o|i<<c)>>>0}}function Sl(t,e,n,r,s){let i=(n>>>16)*(s&65535)>>>0,o=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((o>>>16)+(i>>>16))>>>0;o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(a=a+1>>>0),i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(e,s)>>>0,t[0]=a,t[1]=c}function Ji(t,e,n,r,s){let i=e+r>>>0;const o=n+s>>>0;o>>>0<n>>>0&&(i=i+1|0),t[0]=i,t[1]=o}const es=Symbol.for("effect/Utils/YieldWrap");class an{#t;constructor(e){this.#t=e}[es](){return this.#t}}function kl(t){if(typeof t=="object"&&t!==null&&es in t)return t[es]();throw new Error(gr("yieldWrapGet"))}const st=R("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Xo={effect_internal_function:t=>t()},vl={effect_internal_function:t=>{try{return t()}finally{}}},wl=Xo.effect_internal_function(()=>new Error().stack)?.includes("effect_internal_function")===!0,z=wl?Xo.effect_internal_function:vl.effect_internal_function,Ur=R(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),w=Symbol.for("effect/Hash"),_=t=>{if(st.enabled===!0)return 0;switch(typeof t){case"number":return Ds(t);case"bigint":return x(t.toString(10));case"boolean":return x(String(t));case"symbol":return x(String(t));case"string":return x(t);case"undefined":return x("undefined");case"function":case"object":return t===null?x("null"):t instanceof Date?_(t.toISOString()):t instanceof URL?_(t.href):Il(t)?t[w]():js(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},js=t=>(Ur.has(t)||Ur.set(t,Ds(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Ur.get(t)),E=t=>e=>e*53^t,mr=t=>t&3221225471|t>>>1&1073741824,Il=t=>O(t,w),Ds=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return mr(e)},x=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return mr(e)},Ol=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=f(x(e[r]),E(_(t[e[r]])));return mr(n)},Zo=t=>Ol(t,Object.keys(t)),un=t=>{let e=6151;for(let n=0;n<t.length;n++)e=f(e,E(_(t[n])));return mr(e)},N=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,w,{value(){return r},enumerable:!1}),r}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,w,{value(){return e},enumerable:!1}),e},k=Symbol.for("effect/Equal");function v(){return arguments.length===1?t=>Vn(t,arguments[0]):Vn(arguments[0],arguments[1])}function Vn(t,e){if(t===e)return!0;const n=typeof t;if(n!==typeof e)return!1;if(n==="object"||n==="function"){if(t!==null&&e!==null){if(Kn(t)&&Kn(e))return _(t)===_(e)&&t[k](e)?!0:st.enabled&&st.tester?st.tester(t,e):!1;if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString();if(t instanceof URL&&e instanceof URL)return t.href===e.href}if(st.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((r,s)=>Vn(r,e[s]));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),s=Object.keys(e);if(r.length===s.length){for(const i of r)if(!(i in e&&Vn(t[i],e[i])))return st.tester?st.tester(t,e):!1;return!0}}return st.tester?st.tester(t,e):!1}}return st.enabled&&st.tester?st.tester(t,e):!1}const Kn=t=>O(t,k),qs=()=>v,A=Symbol.for("nodejs.util.inspect.custom"),q=t=>{try{if(O(t,"toJSON")&&dr(t.toJSON)&&t.toJSON.length===0)return t.toJSON();if(Array.isArray(t))return t.map(q)}catch{return{}}return $l(t)},V=t=>JSON.stringify(t,null,2),ue=(t,e=2)=>{if(typeof t=="string")return t;try{return typeof t=="object"?tc(t,e):String(t)}catch{return String(t)}},tc=(t,e)=>{let n=[];const r=JSON.stringify(t,(s,i)=>typeof i=="object"&&i!==null?n.includes(i)?void 0:n.push(i)&&(Jt.fiberRefs!==void 0&&ec(i)?i[Us](Jt.fiberRefs):i):i,e);return n=void 0,r},Us=Symbol.for("effect/Inspectable/Redactable"),ec=t=>typeof t=="object"&&t!==null&&Us in t,Jt=R("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),El=(t,e)=>{const n=Jt.fiberRefs;Jt.fiberRefs=t;try{return e()}finally{Jt.fiberRefs=n}},$l=t=>ec(t)&&Jt.fiberRefs!==void 0?t[Us](Jt.fiberRefs):t,y=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},Ye="Async",_r="Commit",at="Failure",Br="OnFailure",Jn="OnSuccess",Hn="OnSuccessAndFailure",ut="Success",nc="Sync",Ml="Tag",ln="UpdateRuntimeFlags",Gn="While",An="Iterator",rc="WithRuntime",Pn="Yield",Bs="RevertFlags";let Rl="3.19.6";const Vs=()=>Rl,Tl=Symbol.for("effect/Effect"),Cl=Symbol.for("effect/Stream"),Fl=Symbol.for("effect/Sink"),Nl=Symbol.for("effect/Channel"),le={_R:t=>t,_E:t=>t,_A:t=>t,_V:Vs()},Al={_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},Pl={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},fn={[Tl]:le,[Cl]:le,[Fl]:Al,[Nl]:Pl,[k](t){return this===t},[w](){return N(this,js(this))},[Symbol.iterator](){return new zo(new an(this))},pipe(){return y(this,arguments)}},Ks={[w](){return N(this,Zo(this))},[k](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&v(this[r],t[r])))return!1;return!0}},hn={...fn,_op:_r},xl={...hn,...Ks},Ll=(function(){function t(){}return t.prototype=hn,t})(),sc=Symbol.for("effect/Option"),ic={...fn,[sc]:{_A:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},jl=Object.assign(Object.create(ic),{_tag:"Some",_op:"Some",[k](t){return oc(t)&&ac(t)&&v(this.value,t.value)},[w](){return N(this,E(_(this._tag))(_(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:q(this.value)}}}),Dl=_("None"),ql=Object.assign(Object.create(ic),{_tag:"None",_op:"None",[k](t){return oc(t)&&cc(t)},[w](){return Dl},toJSON(){return{_id:"Option",_tag:this._tag}}}),oc=t=>O(t,sc),cc=t=>t._tag==="None",ac=t=>t._tag==="Some",uc=Object.create(ql),ns=t=>{const e=Object.create(jl);return e.value=t,e},lc=Symbol.for("effect/Either"),fc={...fn,[lc]:{_R:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},Ul=Object.assign(Object.create(fc),{_tag:"Right",_op:"Right",[k](t){return hc(t)&&pc(t)&&v(this.right,t.right)},[w](){return E(_(this._tag))(_(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:q(this.right)}}}),Bl=Object.assign(Object.create(fc),{_tag:"Left",_op:"Left",[k](t){return hc(t)&&dc(t)&&v(this.left,t.left)},[w](){return E(_(this._tag))(_(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:q(this.left)}}}),hc=t=>O(t,lc),dc=t=>t._tag==="Left",pc=t=>t._tag==="Right",Vl=t=>{const e=Object.create(Bl);return e.left=t,e},Kl=t=>{const e=Object.create(Ul);return e.right=t,e},Mt=Kl,fe=Vl,We=dc,$n=pc,Jl=u(2,(t,{onLeft:e,onRight:n})=>We(t)?e(t.left):n(t.right)),Hl=Jl({onLeft:U,onRight:U}),gc=t=>t.length>0,mc=t=>(e,n)=>e===n?0:t(e,n),Gl=mc((t,e)=>t<e?-1:1),Wl=u(2,(t,e)=>mc((n,r)=>t(e(n),e(r)))),Yl=t=>u(2,(e,n)=>t(e,n)===1),S=()=>uc,M=ns,Q=cc,St=ac,Js=u(2,(t,{onNone:e,onSome:n})=>Q(t)?e():n(t.value)),Wt=u(2,(t,e)=>Q(t)?e():t.value),zl=u(2,(t,e)=>Q(t)?M(e()):t),Hs=t=>t==null?S():M(t),Dt=Wt(Wo),Ql=u(2,(t,e)=>Q(t)?S():M(e(t.value))),Xl=u(2,(t,e)=>Q(t)?S():e(t.value)),Zl=t=>u(2,(e,n)=>Q(e)?!1:t(e.value,n)),tf=qs(),ef=Zl(tf),nf=(...t)=>t,Gs=t=>new Array(t),rf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(t)),r=new Array(n);for(let s=0;s<n;s++)r[s]=e(s);return r}),B=t=>Array.isArray(t)?t:Array.from(t),sf=t=>Array.isArray(t)?t:[t],Wn=u(2,(t,e)=>[e,...t]),of=u(2,(t,e)=>[...t,e]),_c=u(2,(t,e)=>B(t).concat(B(e))),cf=t=>t.length===0,af=cf,uf=gc,tt=gc,yc=(t,e)=>t<0||t>=e.length,lf=(t,e)=>Math.floor(Math.min(Math.max(0,t),e.length)),ff=u(2,(t,e)=>{const n=Math.floor(e);return yc(n,t)?S():M(t[n])}),bc=u(2,(t,e)=>{const n=Math.floor(e);if(yc(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),ze=ff(0),X=bc(0),hf=t=>tt(t)?M(Sc(t)):S(),Sc=t=>t[t.length-1],he=t=>t.slice(1),df=(t,e)=>{let n=0;for(const r of t){if(!e(r,n))break;n++}return n},pf=u(2,(t,e)=>yf(t,df(t,e))),gf=u(2,(t,e)=>{const n=B(t);return n.slice(lf(e,n),n.length)}),Hi=t=>Array.from(t).reverse(),Yn=u(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),Gi=u(2,(t,e)=>mf(t,e,nf)),mf=u(3,(t,e,n)=>{const r=B(t),s=B(e);if(tt(r)&&tt(s)){const i=[n(X(r),X(s))],o=Math.min(r.length,s.length);for(let c=1;c<o;c++)i[c]=n(r[c],s[c]);return i}return[]}),_f=qs(),yf=u(2,(t,e)=>{const n=Array.from(t),r=Math.floor(e);return tt(n)?r>=1?bf(n,r):[[],n]:[n,[]]}),bf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(e));return n>=t.length?[Sf(t),[]]:[Wn(t.slice(1,n),X(t)),t.slice(n)]}),Sf=t=>t.slice(),kf=u(3,(t,e,n)=>{const r=B(t),s=B(e);return tt(r)?tt(s)?vc(n)(_c(r,s)):r:s}),xn=u(2,(t,e)=>kf(t,e,_f)),de=()=>[],ft=t=>[t],ie=u(2,(t,e)=>t.map(e)),vf=u(2,(t,e)=>{if(af(t))return[];const n=[];for(let r=0;r<t.length;r++){const s=e(t[r],r);for(let i=0;i<s.length;i++)n.push(s[i])}return n}),wf=vf(U),kc=u(3,(t,e,n)=>B(t).reduce((r,s,i)=>n(r,s,i),e)),Wi=(t,e)=>{const n=[];let r=t,s;for(;St(s=e(r));){const[i,o]=s.value;n.push(i),r=o}return n},Ws=al,vc=u(2,(t,e)=>{const n=B(t);if(tt(n)){const r=[X(n)],s=he(n);for(const i of s)r.every(o=>!e(i,o))&&r.push(i);return r}return[]}),If=t=>vc(t,qs()),Te=u(2,(t,e)=>B(t).join(e)),Ze=Gl,Of=t=>t.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Ef=Symbol.for("effect/Context/Tag"),zn=Symbol.for("effect/Context/Reference"),$f="effect/STM",Mf=Symbol.for($f),wc={...fn,_op:"Tag",[Mf]:le,[Ef]:{_Service:t=>t,_Identifier:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[A](){return this.toJSON()},of(t){return t},context(t){return jf(this,t)}},Rf={...wc,[zn]:zn},Tf=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(wc);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=t,r},Cf=()=>(t,e)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,Rf),s.key=t,s.defaultValue=e.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},Ic=Symbol.for("effect/Context"),Ff={[Ic]:{_Services:t=>t},[k](t){if(Af(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!v(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[w](){return N(this,Ds(this.unsafeMap.size))},pipe(){return y(this,arguments)},toString(){return V(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(q)}},[A](){return this.toJSON()}},pe=t=>{const e=Object.create(Ff);return e.unsafeMap=t,e},Nf=t=>{const e=new Error(`Service not found${t.key?`: ${String(t.key)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},Af=t=>O(t,Ic),Pf=t=>O(t,zn),xf=pe(new Map),Lf=()=>xf,jf=(t,e)=>pe(new Map([[t.key,e]])),Df=u(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e.key,n),pe(r)}),Vr=R("effect/Context/defaultValueCache",()=>new Map),Ys=t=>{if(Vr.has(t.key))return Vr.get(t.key);const e=t.defaultValue();return Vr.set(t.key,e),e},qf=(t,e)=>t.unsafeMap.has(e.key)?t.unsafeMap.get(e.key):Ys(e),Oc=u(2,(t,e)=>{if(!t.unsafeMap.has(e.key)){if(zn in e)return Ys(e);throw Nf(e)}return t.unsafeMap.get(e.key)}),Uf=Oc,Bf=u(2,(t,e)=>t.unsafeMap.has(e.key)?ns(t.unsafeMap.get(e.key)):Pf(e)?ns(Ys(e)):uc),Vf=u(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return pe(n)}),Ce=Tf,zs=Lf,Ve=Df,Ec=Uf,$c=Oc,Kf=Bf,Jf=Vf,Mc=Cf,Rc=Symbol.for("effect/Chunk");function Hf(t,e,n,r,s){for(let i=e;i<Math.min(t.length,e+s);i++)n[r+i-e]=t[i];return n}const Tc=[],Gf=t=>Ls((e,n)=>e.length===n.length&&Ht(e).every((r,s)=>t(r,oe(n,s)))),Wf=Gf(v),Yf={[Rc]:{_A:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Chunk",values:Ht(this).map(q)}},[A](){return this.toJSON()},[k](t){return Cc(t)&&Wf(this,t)},[w](){return N(this,un(Ht(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Tc[Symbol.iterator]();default:return Ht(this)[Symbol.iterator]()}},pipe(){return y(this,arguments)}},L=t=>{const e=Object.create(Yf);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=bt,e.right=bt;break}case"ISingleton":{e.length=1,e.depth=0,e.left=bt,e.right=bt;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=bt,e.right=bt;break}}return e},Cc=t=>O(t,Rc),bt=L({_tag:"IEmpty"}),Ct=()=>bt,Kr=(...t)=>Xf(t),et=t=>L({_tag:"ISingleton",a:t}),Fc=t=>Cc(t)?t:yr(B(t)),rs=(t,e,n)=>{switch(t.backing._tag){case"IArray":{Hf(t.backing.array,0,e,n,t.length);break}case"IConcat":{rs(t.left,e,n),rs(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=oe(t,r),r+=1,s+=1;break}}},zf=t=>{switch(t.backing._tag){case"IEmpty":return Tc;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return rs(t,e,0),t.backing={_tag:"IArray",array:e},t.left=bt,t.right=bt,t.depth=0,e}}},Ht=zf,Qf=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return L({_tag:"IArray",array:Hi(t.backing.array)});case"IConcat":return L({_tag:"IConcat",left:ge(t.backing.right),right:ge(t.backing.left)});case"ISlice":return yr(Hi(Ht(t)))}},ge=Qf,yr=t=>t.length===0?Ct():t.length===1?et(t[0]):L({_tag:"IArray",array:t}),Xf=t=>yr(t),oe=u(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?oe(t.left,e):oe(t.right,e-t.left.length);case"ISlice":return oe(t.backing.chunk,e+t.backing.offset)}}),Zf=u(2,(t,e)=>ht(t,et(e))),pt=u(2,(t,e)=>ht(et(e),t)),ss=u(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return bt;switch(t.backing._tag){case"ISlice":return L({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?ss(t.right,e-t.left.length):L({_tag:"IConcat",left:ss(t.left,e),right:t.right});default:return L({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),ht=u(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return L({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=ht(t.right,e);return L({_tag:"IConcat",left:t.left,right:r})}else{const r=ht(t.right.right,e);if(r.depth===t.depth-3){const s=L({_tag:"IConcat",left:t.right.left,right:r});return L({_tag:"IConcat",left:t.left,right:s})}else{const s=L({_tag:"IConcat",left:t.left,right:t.right.left});return L({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=ht(t,e.left);return L({_tag:"IConcat",left:r,right:e.right})}else{const r=ht(t,e.left.left);if(r.depth===e.depth-3){const s=L({_tag:"IConcat",left:r,right:e.left.right});return L({_tag:"IConcat",left:s,right:e.right})}else{const s=L({_tag:"IConcat",left:e.left.right,right:e.right});return L({_tag:"IConcat",left:r,right:s})}}}),th=t=>t.length===0,me=t=>t.length>0,Nc=t=>oe(t,0),_e=Nc,Ut=t=>ss(t,1),is=Symbol.for("effect/Duration"),Ac=BigInt(0),Yi=BigInt(24),Mn=BigInt(60),os=BigInt(1e3),zi=BigInt(1e6),Qi=BigInt(1e9),eh=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,Ft=t=>{if(Pc(t))return t;if(ts(t))return cs(t);if(ll(t))return Jr(t);if(Array.isArray(t)&&t.length===2&&t.every(ts))return t[0]===-1/0||t[1]===-1/0||Number.isNaN(t[0])||Number.isNaN(t[1])?xc:t[0]===1/0||t[1]===1/0?ih:Jr(BigInt(Math.round(t[0]*1e9))+BigInt(Math.round(t[1])));if(ul(t)){const e=eh.exec(t);if(e){const[n,r,s]=e,i=Number(r);switch(s){case"nano":case"nanos":return Jr(BigInt(r));case"micro":case"micros":return oh(BigInt(r));case"milli":case"millis":return cs(i);case"second":case"seconds":return ch(i);case"minute":case"minutes":return ah(i);case"hour":case"hours":return uh(i);case"day":case"days":return lh(i);case"week":case"weeks":return fh(i)}}}throw new Error("Invalid DurationInput")},Xi={_tag:"Millis",millis:0},nh={_tag:"Infinity"},rh={[is]:is,[w](){return N(this,Zo(this.value))},[k](t){return Pc(t)&&yh(this,t)},toString(){return`Duration(${Sh(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:dh(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},vt=t=>{const e=Object.create(rh);return ts(t)?isNaN(t)||t<=0?e.value=Xi:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=nh:t<=Ac?e.value=Xi:e.value={_tag:"Nanos",nanos:t},e},Pc=t=>O(t,is),sh=t=>{switch(t.value._tag){case"Millis":return t.value.millis===0;case"Nanos":return t.value.nanos===Ac;case"Infinity":return!1}},xc=vt(0),ih=vt(1/0),Jr=t=>vt(t),oh=t=>vt(t*os),cs=t=>vt(t),ch=t=>vt(t*1e3),ah=t=>vt(t*6e4),uh=t=>vt(t*36e5),lh=t=>vt(t*864e5),fh=t=>vt(t*6048e5),as=t=>ph(t,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),hh=t=>{const e=Ft(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},dh=t=>{const e=Ft(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/Qi),Number(e.value.nanos%Qi)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},ph=u(2,(t,e)=>{const n=Ft(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),Qs=u(3,(t,e,n)=>{const r=Ft(t),s=Ft(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(as(r),as(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const i=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),o=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(i,o)}return n.onMillis(r.value.millis,s.value.millis)}),gh=(t,e)=>Qs(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),mh=u(2,(t,e)=>Qs(t,e,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),_h=u(2,(t,e)=>Qs(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),yh=u(2,(t,e)=>gh(Ft(t),Ft(e))),bh=t=>{const e=Ft(t);if(e.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=hh(e),r=n/zi,s=r/os,i=s/Mn,o=i/Mn,c=o/Yi;return{days:Number(c),hours:Number(o%Yi),minutes:Number(i%Mn),seconds:Number(s%Mn),millis:Number(r%os),nanos:Number(n%zi)}},Sh=t=>{const e=Ft(t);if(e.value._tag==="Infinity")return"Infinity";if(sh(e))return"0";const n=bh(e),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Yt=5,Xs=Math.pow(2,Yt),kh=Xs-1,vh=Xs/2,wh=Xs/4;function Ih(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function ye(t,e){return e>>>t&kh}function se(t){return 1<<t}function Lc(t,e){return Ih(t&e-1)}const Oh=(t,e)=>({value:t,previous:e});function ce(t,e,n,r){let s=r;if(!t){const i=r.length;s=new Array(i);for(let o=0;o<i;++o)s[o]=r[o]}return s[e]=n,s}function jc(t,e,n){const r=n.length-1;let s=0,i=0,o=n;if(t)s=i=e;else for(o=new Array(r);s<e;)o[i++]=n[s++];for(++s;s<=r;)o[i++]=n[s++];return t&&(o.length=r),o}function Eh(t,e,n,r){const s=r.length;if(t){let a=s;for(;a>=e;)r[a--]=r[a];return r[e]=n,r}let i=0,o=0;const c=new Array(s+1);for(;i<e;)c[o++]=r[i++];for(c[e]=n;i<s;)c[++o]=r[i++];return c}class Pt{_tag="EmptyNode";modify(e,n,r,s,i,o){const c=r(S());return Q(c)?new Pt:(++o.value,new Gt(e,s,i,c))}}function dt(t){return Yo(t,"EmptyNode")}function $h(t){return dt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function br(t,e){return dt(t)?!1:e===t.edit}class Gt{edit;hash;key;value;_tag="LeafNode";constructor(e,n,r,s){this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,i,o){if(v(i,this.key)){const a=r(this.value);return a===this.value?this:Q(a)?(--o.value,new Pt):br(this,e)?(this.value=a,this):new Gt(e,s,i,a)}const c=r(S());return Q(c)?this:(++o.value,Dc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}}class Zs{edit;hash;children;_tag="CollisionNode";constructor(e,n,r){this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,i,o){if(s===this.hash){const a=br(this,e),l=this.updateCollisionList(a,e,this.hash,this.children,r,i,o);return l===this.children?this:l.length>1?new Zs(e,this.hash,l):l[0]}const c=r(S());return Q(c)?this:(++o.value,Dc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}updateCollisionList(e,n,r,s,i,o,c){const a=s.length;for(let d=0;d<a;++d){const h=s[d];if("key"in h&&v(o,h.key)){const p=h.value,g=i(p);return g===p?s:Q(g)?(--c.value,jc(e,d,s)):ce(e,d,new Gt(n,r,o,g),s)}}const l=i(S());return Q(l)?s:(++c.value,ce(e,a,new Gt(n,r,o,l),s))}}class be{edit;mask;children;_tag="IndexedNode";constructor(e,n,r){this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,i,o){const c=this.mask,a=this.children,l=ye(n,s),d=se(l),h=Lc(c,d),p=c&d,g=br(this,e);if(!p){const J=new Pt().modify(e,n+Yt,r,s,i,o);return J?a.length>=vh?Rh(e,l,J,c,a):new be(e,c|d,Eh(g,h,J,a)):this}const m=a[h],$=m.modify(e,n+Yt,r,s,i,o);if(m===$)return this;let F=c,K;if(dt($)){if(F&=~d,!F)return new Pt;if(a.length<=2&&$h(a[h^1]))return a[h^1];K=jc(g,h,a)}else K=ce(g,h,$,a);return g?(this.mask=F,this.children=K,this):new be(e,F,K)}}class ti{edit;size;children;_tag="ArrayNode";constructor(e,n,r){this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,i,o){let c=this.size;const a=this.children,l=ye(n,s),d=a[l],h=(d||new Pt).modify(e,n+Yt,r,s,i,o);if(d===h)return this;const p=br(this,e);let g;if(dt(d)&&!dt(h))++c,g=ce(p,l,h,a);else if(!dt(d)&&dt(h)){if(--c,c<=wh)return Mh(e,c,l,a);g=ce(p,l,new Pt,a)}else g=ce(p,l,h,a);return p?(this.size=c,this.children=g,this):new ti(e,c,g)}}function Mh(t,e,n,r){const s=new Array(e-1);let i=0,o=0;for(let c=0,a=r.length;c<a;++c)if(c!==n){const l=r[c];l&&!dt(l)&&(s[i++]=l,o|=1<<c)}return new be(t,o,s)}function Rh(t,e,n,r,s){const i=[];let o=r,c=0;for(let a=0;o;++a)o&1&&(i[a]=s[c++]),o>>>=1;return i[e]=n,new ti(t,c+1,i)}function Th(t,e,n,r,s,i){if(n===s)return new Zs(t,n,[i,r]);const o=ye(e,n),c=ye(e,s);if(o===c)return a=>new be(t,se(o)|se(c),[a]);{const a=o<c?[r,i]:[i,r];return new be(t,se(o)|se(c),a)}}function Dc(t,e,n,r,s,i){let o,c=e;for(;;){const a=Th(t,c,n,r,s,i);if(typeof a=="function")o=Oh(a,o),c=c+Yt;else{let l=a;for(;o!=null;)l=o.value(l),o=o.previous;return l}}}const qc="effect/HashMap",us=Symbol.for(qc),Ch={[us]:us,[Symbol.iterator](){return new Sr(this,(t,e)=>[t,e])},[w](){let t=_(qc);for(const e of this)t^=f(_(e[0]),E(_(e[1])));return N(this,t)},[k](t){if(Ah(t)){if(t._size!==this._size)return!1;for(const e of this){const n=f(t,ni(e[0],_(e[0])));if(Q(n))return!1;if(!v(e[1],n.value))return!1}return!0}return!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},ei=(t,e,n,r)=>{const s=Object.create(Ch);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class Sr{map;f;v;constructor(e,n){this.map=e,this.f=n,this.v=Uc(this.map._root,this.f,void 0)}next(){if(Q(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Qn(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Sr(this.map,this.f)}}const Qn=t=>t?Bc(t[0],t[1],t[2],t[3],t[4]):S(),Uc=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return St(t.value)?M({value:e(t.key,t.value.value),cont:n}):Qn(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return Bc(r.length,r,0,e,n)}default:return Qn(n)}},Bc=(t,e,n,r,s)=>{for(;n<t;){const i=e[n++];if(i&&!dt(i))return Uc(i,r,[t,e,n,r,s])}return Qn(s)},Fh=ei(!1,0,new Pt,0),kr=()=>Fh,Nh=t=>{const e=Kc(kr());for(const n of t)tn(e,n[0],n[1]);return Dh(e)},Ah=t=>O(t,us),Ph=t=>t&&dt(t._root),xh=u(2,(t,e)=>ni(t,e,_(e))),ni=u(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return v(e,r.key)?r.value:S();case"CollisionNode":{if(n===r.hash){const i=r.children;for(let o=0,c=i.length;o<c;++o){const a=i[o];if("key"in a&&v(e,a.key))return a.value}}return S()}case"IndexedNode":{const i=ye(s,n),o=se(i);if(r.mask&o){r=r.children[Lc(r.mask,o)],s+=Yt;break}return S()}case"ArrayNode":{if(r=r.children[ye(s,n)],r){s+=Yt;break}return S()}default:return S()}}),Lh=u(2,(t,e)=>St(ni(t,e,_(e)))),tn=u(3,(t,e,n)=>ri(t,e,()=>M(n))),jh=u(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:ei(t._editable,t._edit,e,n)),Vc=t=>new Sr(t,e=>e),ls=t=>t._size,Kc=t=>ei(!0,t._edit+1,t._root,t._size),Dh=t=>(t._editable=!1,t),ri=u(3,(t,e,n)=>qh(t,e,_(e),n)),qh=u(4,(t,e,n,r)=>{const s={value:t._size},i=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return f(t,jh(i,s.value))}),Zi=u(2,(t,e)=>ri(t,e,S)),Uh=u(2,(t,e)=>vr(t,kr(),(n,r,s)=>tn(n,s,e(r,s)))),Bh=u(2,(t,e)=>vr(t,void 0,(n,r,s)=>e(r,s))),vr=u(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return St(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let i;for(;i=s.pop();)for(let o=0,c=i.length;o<c;){const a=i[o++];a&&!dt(a)&&(a._tag==="LeafNode"?St(a.value)&&(e=n(e,a.value.value,a.key)):s.push(a.children))}return e}),Jc="effect/HashSet",fs=Symbol.for(Jc),Vh={[fs]:fs,[Symbol.iterator](){return Vc(this._keyMap)},[w](){return N(this,E(_(this._keyMap))(_(Jc)))},[k](t){return Kh(t)?ls(this._keyMap)===ls(t._keyMap)&&v(this._keyMap,t._keyMap):!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},wr=t=>{const e=Object.create(Vh);return e._keyMap=t,e},Kh=t=>O(t,fs),Jh=wr(kr()),Ir=()=>Jh,Hh=t=>{const e=si(Ir());for(const n of t)en(e,n);return ii(e)},Gh=(...t)=>{const e=si(Ir());for(const n of t)en(e,n);return ii(e)},Wh=u(2,(t,e)=>Lh(t._keyMap,e)),Yh=t=>ls(t._keyMap),si=t=>wr(Kc(t._keyMap)),ii=t=>(t._keyMap._editable=!1,t),Hc=u(2,(t,e)=>{const n=si(t);return e(n),ii(n)}),en=u(2,(t,e)=>t._keyMap._editable?(tn(e,!0)(t._keyMap),t):wr(tn(e,!0)(t._keyMap))),Gc=u(2,(t,e)=>t._keyMap._editable?(Zi(e)(t._keyMap),t):wr(Zi(e)(t._keyMap))),zh=u(2,(t,e)=>Hc(t,n=>{for(const r of e)Gc(n,r)})),Qh=u(2,(t,e)=>Hc(Ir(),n=>{Xh(t,r=>en(n,r));for(const r of e)en(n,r)})),Xh=u(2,(t,e)=>Bh(t._keyMap,(n,r)=>e(r))),Zh=u(3,(t,e,n)=>vr(t._keyMap,e,(r,s,i)=>n(r,i))),zt=Ir,td=Hh,oi=Gh,ed=Wh,Wc=Yh,Qe=en,Yc=Gc,to=zh,nn=Qh,Xn=Zh,eo=Symbol.for("effect/MutableRef"),nd={[eo]:eo,toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableRef",current:q(this.current)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},zc=t=>{const e=Object.create(nd);return e.current=t,e},Or=t=>t.current,Qc=u(2,(t,e)=>(t.current=e,t)),ci="effect/FiberId",rn=Symbol.for(ci),Zn="None",hs="Runtime",rd="Composite",sd=x(`${ci}-${Zn}`);let id=class{[rn]=rn;_tag=Zn;id=-1;startTimeMillis=-1;[w](){return sd}[k](e){return Xc(e)&&e._tag===Zn}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[A](){return this.toJSON()}};class od{id;startTimeMillis;[rn]=rn;_tag=hs;constructor(e,n){this.id=e,this.startTimeMillis=n}[w](){return N(this,x(`${ci}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[k](e){return Xc(e)&&e._tag===hs&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[A](){return this.toJSON()}}const cd=new id,Xc=t=>O(t,rn),ds=t=>{switch(t._tag){case Zn:return zt();case hs:return oi(t.id);case rd:return f(ds(t.left),nn(ds(t.right)))}},no=R(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>zc(0)),Zc=t=>Array.from(ds(t)).map(n=>`#${n}`).join(","),ad=()=>{const t=Or(no);return f(no,Qc(t+1)),new od(t,Date.now())},Se=cd,ud=Zc,ta=ad,ai=kr,ld=Nh,fd=Ph,ea=xh,na=tn,ra=Vc,hd=ri,dd=Uh,sa=vr,sn=Symbol.for("effect/List"),ps=t=>B(t),pd=t=>cl(Ws(t),ps),gd=pd(v),md={[sn]:sn,_tag:"Cons",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:ps(this).map(q)}},[A](){return this.toJSON()},[k](t){return oa(t)&&this._tag===t._tag&&gd(this,t)},[w](){return N(this,un(ps(this)))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return y(this,arguments)}},tr=(t,e)=>{const n=Object.create(md);return n.head=t,n.tail=e,n},_d=x("Nil"),yd={[sn]:sn,_tag:"Nil",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[A](){return this.toJSON()},[w](){return _d},[k](t){return oa(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return y(this,arguments)}},ia=Object.create(yd),oa=t=>O(t,sn),Rt=t=>t._tag==="Nil",bd=t=>t._tag==="Cons",Sd=()=>ia,Qt=(t,e)=>tr(t,e),ke=Sd,ui=t=>tr(t,ia),kd=u(2,(t,e)=>wd(e,t)),vd=u(2,(t,e)=>Qt(e,t)),wd=u(2,(t,e)=>{if(Rt(t))return e;if(Rt(e))return t;{const n=tr(e.head,t);let r=n,s=e.tail;for(;!Rt(s);){const i=tr(s.head,t);r.tail=i,r=i,s=s.tail}return n}}),Id=u(3,(t,e,n)=>{let r=e,s=t;for(;!Rt(s);)r=n(r,s.head),s=s.tail;return r}),Od=t=>{let e=ke(),n=t;for(;!Rt(n);)e=vd(e,n.head),n=n.tail;return e},li=(function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Ks,t})(),Ed=Symbol.for("effect/DifferContextPatch");function ro(t){return t}const dn={...li.prototype,[Ed]:{_Value:ro,_Patch:ro}},$d=Object.assign(Object.create(dn),{_tag:"Empty"}),Md=Object.create($d),ca=()=>Md,Rd=Object.assign(Object.create(dn),{_tag:"AndThen"}),Td=(t,e)=>{const n=Object.create(Rd);return n.first=t,n.second=e,n},Cd=Object.assign(Object.create(dn),{_tag:"AddService"}),Fd=(t,e)=>{const n=Object.create(Cd);return n.key=t,n.service=e,n},Nd=Object.assign(Object.create(dn),{_tag:"RemoveService"}),Ad=t=>{const e=Object.create(Nd);return e.key=t,e},Pd=Object.assign(Object.create(dn),{_tag:"UpdateService"}),xd=(t,e)=>{const n=Object.create(Pd);return n.key=t,n.update=e,n},Ld=(t,e)=>{const n=new Map(t.unsafeMap);let r=ca();for(const[s,i]of e.unsafeMap.entries())if(n.has(s)){const o=n.get(s);n.delete(s),v(o,i)||(r=Ln(xd(s,()=>i))(r))}else n.delete(s),r=Ln(Fd(s,i))(r);for(const[s]of n.entries())r=Ln(Ad(s))(r);return r},Ln=u(2,(t,e)=>Td(t,e)),jd=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=!1,r=et(t);const s=new Map(e.unsafeMap);for(;me(r);){const o=_e(r),c=Ut(r);switch(o._tag){case"Empty":{r=c;break}case"AddService":{s.set(o.key,o.service),r=c;break}case"AndThen":{r=pt(pt(c,o.second),o.first);break}case"RemoveService":{s.delete(o.key),r=c;break}case"UpdateService":{s.set(o.key,o.update(s.get(o.key))),n=!0,r=c;break}}}if(!n)return pe(s);const i=new Map;for(const[o]of e.unsafeMap)s.has(o)&&(i.set(o,s.get(o)),s.delete(o));for(const[o,c]of s)i.set(o,c);return pe(i)}),Dd=Symbol.for("effect/DifferHashSetPatch");function Hr(t){return t}const Er={...li.prototype,[Dd]:{_Value:Hr,_Key:Hr,_Patch:Hr}},qd=Object.assign(Object.create(Er),{_tag:"Empty"}),Ud=Object.create(qd),aa=()=>Ud,Bd=Object.assign(Object.create(Er),{_tag:"AndThen"}),Vd=(t,e)=>{const n=Object.create(Bd);return n.first=t,n.second=e,n},Kd=Object.assign(Object.create(Er),{_tag:"Add"}),Jd=t=>{const e=Object.create(Kd);return e.value=t,e},Hd=Object.assign(Object.create(Er),{_tag:"Remove"}),Gd=t=>{const e=Object.create(Hd);return e.value=t,e},Wd=(t,e)=>{const[n,r]=Xn([t,aa()],([s,i],o)=>ed(o)(s)?[Yc(o)(s),i]:[s,gs(Jd(o))(i)])(e);return Xn(r,(s,i)=>gs(Gd(i))(s))(n)},gs=u(2,(t,e)=>Vd(t,e)),Yd=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=e,r=et(t);for(;me(r);){const s=_e(r),i=Ut(r);switch(s._tag){case"Empty":{r=i;break}case"AndThen":{r=pt(s.first)(pt(s.second)(i));break}case"Add":{n=Qe(s.value)(n),r=i;break}case"Remove":n=Yc(s.value)(n),r=i}}return n}),zd=Symbol.for("effect/DifferReadonlyArrayPatch");function so(t){return t}const pn={...li.prototype,[zd]:{_Value:so,_Patch:so}},Qd=Object.assign(Object.create(pn),{_tag:"Empty"}),Xd=Object.create(Qd),ua=()=>Xd,Zd=Object.assign(Object.create(pn),{_tag:"AndThen"}),tp=(t,e)=>{const n=Object.create(Zd);return n.first=t,n.second=e,n},ep=Object.assign(Object.create(pn),{_tag:"Append"}),np=t=>{const e=Object.create(ep);return e.values=t,e},rp=Object.assign(Object.create(pn),{_tag:"Slice"}),sp=(t,e)=>{const n=Object.create(rp);return n.from=t,n.until=e,n},ip=Object.assign(Object.create(pn),{_tag:"Update"}),op=(t,e)=>{const n=Object.create(ip);return n.index=t,n.patch=e,n},cp=t=>{let e=0,n=ua();for(;e<t.oldValue.length&&e<t.newValue.length;){const r=t.oldValue[e],s=t.newValue[e],i=t.differ.diff(r,s);v(i,t.differ.empty)||(n=jn(n,op(e,i))),e=e+1}return e<t.oldValue.length&&(n=jn(n,sp(0,e))),e<t.newValue.length&&(n=jn(n,np(gf(e)(t.newValue)))),n},jn=u(2,(t,e)=>tp(t,e)),ap=u(3,(t,e,n)=>{if(t._tag==="Empty")return e;let r=e.slice(),s=ft(t);for(;uf(s);){const i=X(s),o=he(s);switch(i._tag){case"Empty":{s=o;break}case"AndThen":{o.unshift(i.first,i.second),s=o;break}case"Append":{for(const c of i.values)r.push(c);s=o;break}case"Slice":{r=r.slice(i.from,i.until),s=o;break}case"Update":{r[i.index]=n.patch(i.patch,r[i.index]),s=o;break}}}return r}),up=Symbol.for("effect/Differ"),lp={[up]:{_P:U,_V:U},pipe(){return y(this,arguments)}},Fe=t=>{const e=Object.create(lp);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},fp=()=>Fe({empty:ca(),combine:(t,e)=>Ln(e)(t),diff:(t,e)=>Ld(t,e),patch:(t,e)=>jd(e)(t)}),hp=()=>Fe({empty:aa(),combine:(t,e)=>gs(e)(t),diff:(t,e)=>Wd(t,e),patch:(t,e)=>Yd(e)(t)}),dp=t=>Fe({empty:ua(),combine:(e,n)=>jn(e,n),diff:(e,n)=>cp({oldValue:e,newValue:n,differ:t}),patch:(e,n)=>ap(e,n,t)}),la=()=>pp((t,e)=>e),pp=t=>Fe({empty:U,combine:(e,n)=>e===U?n:n===U?e:r=>n(e(r)),diff:(e,n)=>v(e,n)?U:hr(n),patch:(e,n)=>t(n,e(n))}),on=255,fa=8,ms=t=>t&on,_s=t=>t>>fa&on,gn=(t,e)=>(t&on)+((e&t&on)<<fa),gp=gn(0,0),mp=t=>gn(t,t),_p=t=>gn(t,0),yp=u(2,(t,e)=>gn(ms(t)&~e,_s(t))),bp=u(2,(t,e)=>t|e),Sp=t=>~t>>>0&on,kp=0,Ne=1,vp=2,ha=4,ys=16,da=32,wp=t=>$r(t,da),Ip=u(2,(t,e)=>t|e),Nt=t=>pa(t)&&!Ep(t),pa=t=>$r(t,Ne),$r=u(2,(t,e)=>(t&e)!==0),ga=(...t)=>t.reduce((e,n)=>e|n,0),Op=ga(kp),io=t=>$r(t,ha),Ep=t=>$r(t,ys),Dn=u(2,(t,e)=>gn(t^e,e)),qn=u(2,(t,e)=>t&(Sp(ms(e))|_s(e))|ms(e)&_s(e)),oo=Fe({empty:gp,diff:(t,e)=>Dn(t,e),combine:(t,e)=>bp(e)(t),patch:(t,e)=>qn(e,t)}),$p=mp,ma=_p,co=yp,_a=(t,e)=>({_tag:"Par",left:t,right:e}),Rn=(t,e)=>({_tag:"Seq",left:t,right:e}),Mp=t=>{let e=ui(t),n=ke();for(;;){const[r,s]=Id(e,[ya(),ke()],([i,o],c)=>{const[a,l]=Rp(c);return[Ap(i,a),kd(o,l)]});if(n=Tp(n,r),Rt(s))return Od(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Rp=t=>{let e=t,n=ya(),r=ke(),s=ke();for(;;)switch(e._tag){case"Empty":{if(Rt(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Qt(e.right,r),e=e.left;break}case"Seq":{const i=e.left,o=e.right;switch(i._tag){case"Empty":{e=o;break}case"Par":{const c=i.left,a=i.right;e=_a(Rn(c,o),Rn(a,o));break}case"Seq":{const c=i.left,a=i.right;e=Rn(c,Rn(a,o));break}case"Single":{e=i,s=Qt(o,s);break}}break}case"Single":{if(n=Np(n,e),Rt(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},Tp=(t,e)=>{if(Rt(t))return ui(Gr(e));if(Pp(e))return t;const n=Up(t.head),r=xp(e);return n.length===1&&r.length===1&&v(n[0],r[0])?Qt(qp(t.head,Gr(e)),t.tail):Qt(Gr(e),t)},Cp=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Fp={_R:t=>t};class fi{map;[Cp]=Fp;constructor(e){this.map=e}}const ya=()=>new fi(ai()),Np=(t,e)=>new fi(hd(t.map,e.dataSource,n=>zl(Ql(n,Zf(e.blockedRequest)),()=>et(e.blockedRequest)))),Ap=(t,e)=>new fi(sa(t.map,e.map,(n,r,s)=>na(n,s,Js(ea(n,s),{onNone:()=>r,onSome:i=>ht(r,i)})))),Pp=t=>fd(t.map),xp=t=>Array.from(ra(t.map)),Gr=t=>Dp(dd(t.map,e=>et(e))),Lp=Symbol.for("effect/RequestBlock/RequestBlockSequential"),jp={_R:t=>t};class ba{map;[Lp]=jp;constructor(e){this.map=e}}const Dp=t=>new ba(t),qp=(t,e)=>new ba(sa(e.map,t.map,(n,r,s)=>na(n,s,Js(ea(n,s),{onNone:()=>Ct(),onSome:i=>ht(i,r)})))),Up=t=>Array.from(ra(t.map)),Bp=t=>Array.from(t.map),mn="Die",Xt="Empty",Ae="Fail",Pe="Interrupt",ve="Parallel",we="Sequential",Sa="effect/Cause",ka=Symbol.for(Sa),Vp={_E:t=>t},xe={[ka]:Vp,[w](){return f(_(Sa),E(_(ng(this))),N(this))},[k](t){return Kp(t)&&eg(this,t)},pipe(){return y(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:q(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:q(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:q(this.left),right:q(this.right)}}},toString(){return _n(this)},[A](){return this.toJSON()}},Ie=(()=>{const t=Object.create(xe);return t._tag=Xt,t})(),er=t=>{const e=Object.create(xe);return e._tag=Ae,e.error=t,e},Tt=t=>{const e=Object.create(xe);return e._tag=mn,e.defect=t,e},At=t=>{const e=Object.create(xe);return e._tag=Pe,e.fiberId=t,e},Mr=(t,e)=>{const n=Object.create(xe);return n._tag=ve,n.left=t,n.right=e,n},ot=(t,e)=>{const n=Object.create(xe);return n._tag=we,n.left=t,n.right=e,n},Kp=t=>O(t,ka),Jp=t=>t._tag===Xt,Hp=t=>t._tag===Xt?!0:Oe(t,!0,(e,n)=>{switch(n._tag){case Xt:return M(e);case mn:case Ae:case Pe:return M(!1);default:return S()}}),Gp=t=>St(Zp(t)),hi=t=>di(void 0,sg)(t),Wp=t=>ge(Oe(t,Ct(),(e,n)=>n._tag===Ae?M(f(e,pt(n.error))):S())),Yp=t=>ge(Oe(t,Ct(),(e,n)=>n._tag===mn?M(f(e,pt(n.defect))):S())),zp=t=>Oe(t,zt(),(e,n)=>n._tag===Pe?M(f(e,Qe(n.fiberId))):S()),Qp=t=>va(t,e=>e._tag===Ae?M(e.error):S()),Xp=t=>{const e=Qp(t);switch(e._tag){case"None":return Mt(t);case"Some":return fe(e.value)}},Zp=t=>va(t,e=>e._tag===Pe?M(e.fiberId):S()),ao=t=>wa(t,{onEmpty:Ie,onFail:()=>Ie,onDie:Tt,onInterrupt:At,onSequential:ot,onParallel:Mr}),tg=t=>wa(t,{onEmpty:Ie,onFail:Tt,onDie:Tt,onInterrupt:At,onSequential:ot,onParallel:Mr}),eg=(t,e)=>{let n=et(t),r=et(e);for(;me(n)&&me(r);){const[s,i]=f(_e(n),Oe([zt(),Ct()],([a,l],d)=>{const[h,p]=bs(d);return M([f(a,nn(h)),f(l,ht(p))])})),[o,c]=f(_e(r),Oe([zt(),Ct()],([a,l],d)=>{const[h,p]=bs(d);return M([f(a,nn(h)),f(l,ht(p))])}));if(!v(s,o))return!1;n=i,r=c}return!0},ng=t=>rg(et(t),Ct()),rg=(t,e)=>{for(;;){const[n,r]=f(t,kc([zt(),Ct()],([i,o],c)=>{const[a,l]=bs(c);return[f(i,nn(a)),f(o,ht(l))]})),s=Wc(n)>0?f(e,pt(n)):e;if(th(r))return ge(s);t=r,e=s}throw new Error(gr("Cause.flattenCauseLoop"))},va=u(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case we:case ve:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return S()}),bs=t=>{let e=t;const n=[];let r=zt(),s=Ct();for(;e!==void 0;)switch(e._tag){case Xt:{if(n.length===0)return[r,s];e=n.pop();break}case Ae:{if(r=Qe(r,Kr(e._tag,e.error)),n.length===0)return[r,s];e=n.pop();break}case mn:{if(r=Qe(r,Kr(e._tag,e.defect)),n.length===0)return[r,s];e=n.pop();break}case Pe:{if(r=Qe(r,Kr(e._tag,e.fiberId)),n.length===0)return[r,s];e=n.pop();break}case we:{switch(e.left._tag){case Xt:{e=e.right;break}case we:{e=ot(e.left.left,ot(e.left.right,e.right));break}case ve:{e=Mr(ot(e.left.left,e.right),ot(e.left.right,e.right));break}default:{s=pt(s,e.right),e=e.left;break}}break}case ve:{n.push(e.right),e=e.left;break}}throw new Error(gr("Cause.evaluateCauseLoop"))},sg={emptyCase:Vi,failCase:Zr,dieCase:Zr,interruptCase:Vi,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},uo="SequentialCase",lo="ParallelCase",wa=u(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:i,onSequential:o})=>di(t,void 0,{emptyCase:()=>n,failCase:(c,a)=>r(a),dieCase:(c,a)=>e(a),interruptCase:(c,a)=>s(a),sequentialCase:(c,a,l)=>o(a,l),parallelCase:(c,a,l)=>i(a,l)})),Oe=u(3,(t,e,n)=>{let r=e,s=t;const i=[];for(;s!==void 0;){const o=n(r,s);switch(r=St(o)?o.value:r,s._tag){case we:{i.push(s.right),s=s.left;break}case ve:{i.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&i.length>0&&(s=i.pop())}return r}),di=u(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const o=r.pop();switch(o._tag){case Xt:{s.push(Mt(n.emptyCase(e)));break}case Ae:{s.push(Mt(n.failCase(e,o.error)));break}case mn:{s.push(Mt(n.dieCase(e,o.defect)));break}case Pe:{s.push(Mt(n.interruptCase(e,o.fiberId)));break}case we:{r.push(o.right),r.push(o.left),s.push(fe({_tag:uo}));break}case ve:{r.push(o.right),r.push(o.left),s.push(fe({_tag:lo}));break}}}const i=[];for(;s.length>0;){const o=s.pop();switch(o._tag){case"Left":{switch(o.left._tag){case uo:{const c=i.pop(),a=i.pop(),l=n.sequentialCase(e,c,a);i.push(l);break}case lo:{const c=i.pop(),a=i.pop(),l=n.parallelCase(e,c,a);i.push(l);break}}break}case"Right":{i.push(o.right);break}}}if(i.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()}),_n=(t,e)=>hi(t)?"All fibers interrupted without errors.":Oa(t).map(function(n){return e?.renderErrorCause!==!0||n.cause===void 0?n.stack:`${n.stack} {
${Ia(n.cause,"  ")}
}`}).join(`
`),Ia=(t,e)=>{const n=t.stack.split(`
`);let r=`${e}[cause]: ${n[0]}`;for(let s=1,i=n.length;s<i;s++)r+=`
${e}${n[s]}`;return t.cause&&(r+=` {
${Ia(t.cause,`${e}  `)}
${e}}`),r};class nr extends globalThis.Error{span=void 0;constructor(e){const n=typeof e=="object"&&e!==null,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(ig(e),n&&"cause"in e&&typeof e.cause<"u"?{cause:new nr(e.cause)}:void 0),this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=e instanceof Error?e.name:"Error",n&&(Ee in e&&(this.span=e[Ee]),Object.keys(e).forEach(s=>{s in this||(this[s]=e[s])})),this.stack=ag(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}const ig=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&t instanceof Error)return t.message;try{if(O(t,"toString")&&dr(t.toString)&&t.toString!==Object.prototype.toString&&t.toString!==globalThis.Array.prototype.toString)return t.toString()}catch{}return tc(t)},og=/\((.*)\)/g,cg=R("effect/Tracer/spanToTrace",()=>new WeakMap),ag=(t,e,n)=>{const r=[t],s=e.startsWith(t)?e.slice(t.length).split(`
`):e.split(`
`);for(let i=1;i<s.length;i++){if(s[i].includes(" at new BaseEffectError")||s[i].includes(" at new YieldableError")){i++;continue}if(s[i].includes("Generator.next")||s[i].includes("effect_internal_function"))break;r.push(s[i].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let i=n,o=0;for(;i&&i._tag==="Span"&&o<10;){const c=cg.get(i);if(typeof c=="function"){const a=c();if(typeof a=="string"){const l=a.matchAll(og);let d=!1;for(const[,h]of l)d=!0,r.push(`    at ${i.name} (${h})`);d||r.push(`    at ${i.name} (${a.replace(/^at /,"")})`)}else r.push(`    at ${i.name}`)}else r.push(`    at ${i.name}`);i=Dt(i.parent),o++}}return r.join(`
`)},Ee=Symbol.for("effect/SpanAnnotation"),Oa=t=>di(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[new nr(n)],failCase:(e,n)=>[new nr(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),Rr="Pending",Ea="Done",ug="effect/Deferred",lg=Symbol.for(ug),fg={_E:t=>t,_A:t=>t},hg=t=>({_tag:Rr,joiners:t}),dg=t=>({_tag:Ea,effect:t});class yn{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new yn(this.self)}}const $a=(t,e)=>{const n=new Y("Blocked");return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n},pg=t=>{const e=new Y("RunBlocked");return e.effect_instruction_i0=t,e},$e=Symbol.for("effect/Effect");class gg{patch;op;_op=Bs;constructor(e,n){this.patch=e,this.op=n}}class Y{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e}[k](e){return this===e}[w](){return N(this,js(this))}pipe(){return y(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:q(this.effect_instruction_i0),effect_instruction_i1:q(this.effect_instruction_i1),effect_instruction_i2:q(this.effect_instruction_i2)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}class Ma{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e,this._tag=e}[k](e){return Nr(e)&&e._op==="Failure"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),E(_(this.effect_instruction_i0)),N(this))}get cause(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}class Ra{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e,this._tag=e}[k](e){return Nr(e)&&e._op==="Success"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),E(_(this.effect_instruction_i0)),N(this))}get value(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:q(this.value)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}const pi=t=>O(t,$e),gt=t=>{const e=new Y(rc);return e.effect_instruction_i0=t,e},mg=u(3,(t,e,n)=>Cr(r=>I(t,s=>I(Fa(G(()=>r(e(s)))),i=>G(()=>n(s,i)).pipe(Me({onFailure:o=>{switch(i._tag){case at:return mt(ot(i.effect_instruction_i0,o));case ut:return mt(o)}},onSuccess:()=>i})))))),bn=u(2,(t,e)=>I(t,()=>C(e))),Sn=t=>bn(t,void 0),Ta=function(){const t=new Y(_r);switch(arguments.length){case 2:{t.effect_instruction_i0=arguments[0],t.commit=arguments[1];break}case 3:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.commit=arguments[2];break}case 4:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.effect_instruction_i2=arguments[2],t.commit=arguments[3];break}default:throw new Error(gr("you're not supposed to end up here"))}return t},rr=(t,e=Se)=>{const n=new Y(Ye);let r;return n.effect_instruction_i0=s=>{r=t(s)},n.effect_instruction_i1=e,La(n,s=>pi(r)?r:kt)},_g=(t,e=Se)=>G(()=>rr(t,e)),Zt=(t,e=Se)=>Ta(t,function(){let n,r;function s(a){n?n(a):r===void 0&&(r=a)}const i=new Y(Ye);i.effect_instruction_i0=a=>{n=a,r&&a(r)},i.effect_instruction_i1=e;let o,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,o=z(()=>this.effect_instruction_i0(s,c.signal))):o=z(()=>this.effect_instruction_i0(s)),o||c?La(i,a=>(c&&c.abort(),o??kt)):i}),fo=u(2,(t,e)=>mi(t,{onFailure:e,onSuccess:C})),ho=Symbol.for("effect/OriginalAnnotation"),Ca=(t,e)=>St(e)?new Proxy(t,{has(n,r){return r===Ee||r===ho||r in n},get(n,r){return r===Ee?e.value:r===ho?t:n[r]}}):t,po=t=>pr(t)&&!(Ee in t)?gt(e=>mt(Tt(Ca(t,eu(e))))):mt(Tt(t)),yg=t=>bg(()=>Tt(new Wg(t))),Ss=t=>mi(t,{onFailure:e=>C(fe(e)),onSuccess:e=>C(Mt(e))}),Fa=t=>kg(t,{onFailure:T,onSuccess:j}),W=t=>pr(t)&&!(Ee in t)?gt(e=>mt(er(Ca(t,eu(e))))):mt(er(t)),gi=t=>I(b(t),W),mt=t=>{const e=new Ma(at);return e.effect_instruction_i0=t,e},bg=t=>I(b(t),mt),Sg=gt(t=>C(t.id())),Na=t=>gt(e=>t(e.id())),I=u(2,(t,e)=>{const n=new Y(Jn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),Aa=t=>I(t,U),kg=u(2,(t,e)=>Me(t,{onFailure:n=>C(e.onFailure(n)),onSuccess:n=>C(e.onSuccess(n))})),Me=u(2,(t,e)=>{const n=new Y(Hn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e.onFailure,n.effect_instruction_i2=e.onSuccess,n}),mi=u(2,(t,e)=>Me(t,{onFailure:n=>{if(Yp(n).length>0)return mt(tg(n));const s=Wp(n);return s.length>0?e.onFailure(Nc(s)):mt(n)},onSuccess:e.onSuccess})),Bt=u(2,(t,e)=>G(()=>{const n=B(t),r=Gs(n.length);let s=0;return bn(bi({while:()=>s<n.length,body:()=>e(n[s],s),step:i=>{r[s++]=i}}),r)})),_i=u(2,(t,e)=>G(()=>{const n=B(t);let r=0;return bi({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),Pa=t=>{const e=new Y(ln);return e.effect_instruction_i0=$p(Ne),e.effect_instruction_i1=()=>t,e},ct=u(2,(t,e)=>I(t,n=>b(()=>e(n)))),xa=u(2,(t,e)=>mi(t,{onFailure:n=>gi(()=>e.onFailure(n)),onSuccess:n=>b(()=>e.onSuccess(n))})),Tr=u(2,(t,e)=>Me(t,{onFailure:n=>{const r=Xp(n);switch(r._tag){case"Left":return gi(()=>e(r.left));case"Right":return mt(r.right)}},onSuccess:C})),yi=u(2,(t,e)=>Cr(n=>Me(n(t),{onFailure:r=>{const s=T(r);return Me(e(s),{onFailure:i=>T(ot(r,i)),onSuccess:()=>s})},onSuccess:r=>{const s=j(r);return Ua(e(s),s)}}))),La=u(2,(t,e)=>yi(t,Xa({onFailure:n=>hi(n)?Sn(e(zp(n))):kt,onSuccess:()=>kt}))),C=t=>{const e=new Ra(ut);return e.effect_instruction_i0=t,e},G=t=>{const e=new Y(_r);return e.commit=t,e},b=t=>{const e=new Y(nc);return e.effect_instruction_i0=t,e},vg=u(t=>t.length===3||t.length===2&&!(pr(t[1])&&"onlyEffect"in t[1]),(t,e)=>I(t,n=>{const r=typeof e=="function"?e(n):e;return pi(r)?bn(r,n):hl(r)?rr(s=>{r.then(i=>s(C(n)),i=>s(W(new Qa(i,"An unknown error occurred in Effect.tap"))))}):C(n)})),wg=t=>gt(e=>{const n=e.getFiberRef(vs),r=f(n,Wt(()=>e.scope()));return t(vi(vs,M(r)))}),ja=t=>{const e=new Y(ln);return e.effect_instruction_i0=ma(Ne),e.effect_instruction_i1=()=>t,e},Cr=t=>Ta(t,function(){const e=new Y(ln);return e.effect_instruction_i0=ma(Ne),e.effect_instruction_i1=n=>pa(n)?z(()=>this.effect_instruction_i0(Pa)):z(()=>this.effect_instruction_i0(ja)),e}),kt=C(void 0),Ig=t=>{const e=new Y(ln);return e.effect_instruction_i0=t,e.effect_instruction_i1=void 0,e},bi=t=>{const e=new Y(Gn);return e.effect_instruction_i0=t.while,e.effect_instruction_i1=t.body,e.effect_instruction_i2=t.step,e},Si=t=>{const e=new Y(Pn);return typeof t?.priority<"u"?Bg(e,t.priority):e},Da=u(2,(t,e)=>I(t,n=>ct(e,r=>[n,r]))),qa=u(2,(t,e)=>I(t,n=>bn(e,n))),Ua=u(2,(t,e)=>I(t,()=>e)),Og=t=>I(Sg,e=>f(t,Ba(e))),Ba=u(2,(t,e)=>I(t.interruptAsFork(e),()=>t.await)),Eg={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return y(this,arguments)}},$g={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return y(this,arguments)}},Mg={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return y(this,arguments)}},Va={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return y(this,arguments)}},Ka={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return y(this,arguments)}},Ja={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return y(this,arguments)}},Rg={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return y(this,arguments)}},Tg={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return y(this,arguments)}},Cg="effect/FiberRef",Fg=Symbol.for(Cg),Ng={_A:t=>t},ki=t=>gt(e=>j(e.getFiberRef(t))),Ha=u(2,(t,e)=>I(ki(t),e)),go=u(2,(t,e)=>Ag(t,()=>[void 0,e])),Ag=u(2,(t,e)=>gt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),C(r)})),vi=u(3,(t,e,n)=>mg(qa(ki(e),go(e,n)),()=>t,r=>go(e,r))),lt=(t,e)=>Le(t,{differ:la(),fork:e?.fork??U,join:e?.join}),Pg=t=>{const e=hp();return Le(t,{differ:e,fork:e.empty})},xg=t=>{const e=dp(la());return Le(t,{differ:e,fork:e.empty})},Ga=t=>{const e=fp();return Le(t,{differ:e,fork:e.empty})},Le=(t,e)=>({...hn,[Fg]:Ng,initial:t,commit(){return ki(this)},diff:(r,s)=>e.differ.diff(r,s),combine:(r,s)=>e.differ.combine(r,s),patch:r=>s=>e.differ.patch(r,s),fork:e.fork,join:e.join??((r,s)=>s)}),Lg=t=>Le(t,{differ:oo,fork:oo.empty}),Fr=R(Symbol.for("effect/FiberRef/currentContext"),()=>Ga(zs())),wi=R(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>lt(0)),jg=R(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>lt(2048)),Dg=R(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>lt(ai())),qg=R(Symbol.for("effect/FiberRef/currentLogLevel"),()=>lt(Ka)),Ug=R(Symbol.for("effect/FiberRef/currentLogSpan"),()=>lt(ke())),Bg=u(2,(t,e)=>vi(t,wi,e)),Vg=R(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>lt(M(Ja))),Kg=R(Symbol.for("effect/FiberRef/versionMismatchErrorLogLevel"),()=>lt(M(Va))),ks=R(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>xg(de())),vs=R(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>lt(S(),{fork:()=>S(),join:(t,e)=>t})),Tn=R(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>lt(Ie,{fork:()=>Ie,join:(t,e)=>t})),Jg=(t,e)=>t.addFinalizer(()=>Sn(e)),Hg=(t,e)=>t.close(e),Gg=(t,e)=>t.fork(e),Wa=(function(){class t extends globalThis.Error{commit(){return W(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[A](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?_n(er(this),{renderErrorCause:!0}):this}}return Object.assign(t.prototype,xl),t})(),Ya=(t,e)=>{class n extends Wa{_tag=e}return Object.assign(n.prototype,t),n.prototype.name=e,n},mo=Symbol.for("effect/Cause/errors/RuntimeException"),Wg=Ya({[mo]:mo},"RuntimeException"),Yg=Symbol.for("effect/Cause/errors/InterruptedException"),zg=t=>O(t,Yg),_o=Symbol.for("effect/Cause/errors/NoSuchElement"),za=Ya({[_o]:_o},"NoSuchElementException"),yo=Symbol.for("effect/Cause/errors/UnknownException"),Qa=(function(){class t extends Wa{_tag="UnknownException";error;constructor(n,r){super(r??"An unknown error occurred",{cause:n}),this.error=n}}return Object.assign(t.prototype,{[yo]:yo,name:"UnknownException"}),t})(),Nr=t=>pi(t)&&"_tag"in t&&(t._tag==="Success"||t._tag==="Failure"),bo=(t,e)=>Zg(t,e?.parallel?Mr:ot),So=t=>T(er(t)),T=t=>{const e=new Ma(at);return e.effect_instruction_i0=t,e},Qg=t=>T(At(t)),Wr=u(2,(t,e)=>{switch(t._tag){case at:return T(t.effect_instruction_i0);case ut:return j(e(t.effect_instruction_i0))}}),Xa=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case at:return e(t.effect_instruction_i0);case ut:return n(t.effect_instruction_i0)}}),j=t=>{const e=new Ra(ut);return e.effect_instruction_i0=t,e},Vt=j(void 0),Xg=u(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case at:switch(e._tag){case ut:return T(t.effect_instruction_i0);case at:return T(n(t.effect_instruction_i0,e.effect_instruction_i0))}case ut:switch(e._tag){case ut:return j(r(t.effect_instruction_i0,e.effect_instruction_i0));case at:return T(e.effect_instruction_i0)}}}),Zg=(t,e)=>{const n=Fc(t);return me(n)?f(Ut(n),kc(f(_e(n),Wr(et)),(r,s)=>f(r,Xg(s,{onSuccess:(i,o)=>f(i,pt(o)),onFailure:e}))),Wr(ge),Wr(r=>Ht(r)),M):S()},tm=t=>({...hn,[lg]:fg,state:zc(hg([])),commit(){return Za(this)},blockingOn:t}),Za=t=>_g(e=>{const n=Or(t.state);switch(n._tag){case Ea:return e(n.effect);case Rr:return n.joiners.push(e),em(t,e)}},t.blockingOn),tu=(t,e)=>{const n=Or(t.state);if(n._tag===Rr){Qc(t.state,dg(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e)}},em=(t,e)=>b(()=>{const n=Or(t.state);if(n._tag===Rr){const r=n.joiners.indexOf(e);r>=0&&n.joiners.splice(r,1)}}),eu=t=>{const e=t.currentSpan;return e!==void 0&&e._tag==="Span"?M(e):S()},ko=Symbol.for("effect/MutableHashMap"),nm={[ko]:ko,[Symbol.iterator](){return new Ii(this)},toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}};class Ii{self;referentialIterator;bucketIterator;constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const e=this.referentialIterator.next();return e.done?(this.bucketIterator=new rm(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new Ii(this.self)}}class rm{backing;constructor(e){this.backing=e}currentBucket;next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}const sm=()=>{const t=Object.create(nm);return t.referential=new Map,t.buckets=new Map,t.bucketsSize=0,t},qt=u(2,(t,e)=>{if(Kn(e)===!1)return t.referential.has(e)?M(t.referential.get(e)):S();const n=e[w](),r=t.buckets.get(n);return r===void 0?S():im(t,r,e)}),im=(t,e,n,r=!1)=>{for(let s=0,i=e.length;s<i;s++)if(n[k](e[s][0])){const o=e[s][1];return r&&(e.splice(s,1),t.bucketsSize--),M(o)}return S()},Ke=u(2,(t,e)=>St(qt(t,e))),Je=u(3,(t,e,n)=>{if(Kn(e)===!1)return t.referential.set(e,n),t;const r=e[w](),s=t.buckets.get(r);return s===void 0?(t.buckets.set(r,[[e,n]]),t.bucketsSize++,t):(om(t,s,e),s.push([e,n]),t.bucketsSize++,t)}),om=(t,e,n)=>{for(let r=0,s=e.length;r<s;r++)if(n[k](e[r][0])){e.splice(r,1),t.bucketsSize--;return}},cm="effect/Clock",vo=Symbol.for(cm),Oi=Ce("effect/Clock"),am=2**31-1,wo={unsafeSchedule(t,e){const n=as(e);if(n>am)return Zr;let r=!1;const s=setTimeout(()=>{r=!0,t()},n);return()=>(clearTimeout(s),!r)}},Io=(function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;let e;return()=>(e===void 0&&(e=BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6))),e+BigInt(Math.round(performance.now()*1e6)))})(),um=(function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return Io;const e=Io()-t.bigint();return()=>e+t.bigint()})();class lm{[vo]=vo;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return um()}currentTimeMillis=b(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=b(()=>this.unsafeCurrentTimeNanos());scheduler(){return C(wo)}sleep(e){return Zt(n=>{const r=wo.unsafeSchedule(()=>n(kt),e);return Sn(b(r))})}}const fm=()=>new lm,nu="And",ru="Or",su="InvalidData",iu="MissingData",ou="SourceUnavailable",cu="Unsupported",hm="effect/ConfigError",Oo=Symbol.for(hm),je={_tag:"ConfigError",[Oo]:Oo},au=(t,e)=>{const n=Object.create(je);return n._op=nu,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},uu=(t,e)=>{const n=Object.create(je);return n._op=ru,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},dm=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=su,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},te=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=iu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},pm=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(je);return s._op=ou,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${f(this.path,Te(r.pathDelim))}: "${this.message}")`}}),s},gm=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=cu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},Kt=u(2,(t,e)=>{switch(t._op){case nu:return au(Kt(t.left,e),Kt(t.right,e));case ru:return uu(Kt(t.left,e),Kt(t.right,e));case su:return dm([...e,...t.path],t.message);case iu:return te([...e,...t.path],t.message);case ou:return pm([...e,...t.path],t.message,t.cause);case cu:return gm([...e,...t.path],t.message)}}),mm={_tag:"Empty"},Yr=u(2,(t,e)=>{let n=ui(e),r=t;for(;bd(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Qt(s.first,Qt(s.second,n.tail));break}case"MapName":{r=ie(r,s.f),n=n.tail;break}case"Nested":{r=Wn(r,s.name),n=n.tail;break}case"Unnested":{if(f(ze(r),ef(s.name)))r=he(r),n=n.tail;else return fe(te(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return Mt(r)}),_m="Constant",ym="Fail",bm="Fallback",Sm="Described",km="Lazy",vm="MapOrFail",wm="Nested",Im="Primitive",Om="Sequence",Em="HashMap",$m="ZipWith";var Eo={};const sr=(t,e)=>[...t,...e],Mm="effect/ConfigProvider",$o=Symbol.for(Mm),Rm=Ce("effect/ConfigProvider"),Tm="effect/ConfigProviderFlat",Mo=Symbol.for(Tm),Cm=t=>({[$o]:$o,pipe(){return y(this,arguments)},...t}),Fm=t=>({[Mo]:Mo,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),Nm=t=>Cm({load:e=>I(it(t,de(),e,!1),n=>Js(ze(n),{onNone:()=>W(te(de(),`Expected a single value having structure: ${e}`)),onSome:C})),flattened:t}),Am=t=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=a=>f(a,Te(e)),s=a=>a.split(e),i=()=>typeof process<"u"&&"env"in process&&typeof Eo=="object"?Eo:{};return Nm(Fm({load:(a,l,d=!0)=>{const h=r(a),p=i(),g=h in p?M(p[h]):S();return f(g,Tr(()=>te(a,`Expected ${h} to exist in the process context`)),I(m=>Dm(m,a,l,n,d)))},enumerateChildren:a=>b(()=>{const l=i(),p=Object.keys(l).map(g=>s(g.toUpperCase())).filter(g=>{for(let m=0;m<a.length;m++){const $=f(a,bc(m)),F=g[m];if(F===void 0||$!==F)return!1}return!0}).flatMap(g=>g.slice(a.length,a.length+1));return td(p)}),patch:mm}))},Pm=(t,e,n,r)=>{const s=Wi(n.length,a=>a>=r.length?S():M([t(a),a+1])),i=Wi(r.length,a=>a>=n.length?S():M([e(a),a+1])),o=sr(n,s),c=sr(r,i);return[o,c]},xm=(t,e)=>{let n=e;if(n._tag==="Nested"){const r=t.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return t},it=(t,e,n,r)=>{const s=n;switch(s._tag){case _m:return C(ft(s.value));case Sm:return G(()=>it(t,e,s.config,r));case ym:return W(te(e,s.message));case bm:return f(G(()=>it(t,e,s.first,r)),fo(i=>s.condition(i)?f(it(t,e,s.second,r),fo(o=>W(uu(i,o)))):W(i)));case km:return G(()=>it(t,e,s.config(),r));case vm:return G(()=>f(it(t,e,s.original,r),I(Bt(i=>f(s.mapOrFail(i),Tr(Kt(xm(e,s.original))))))));case wm:return G(()=>it(t,sr(e,ft(s.name)),s.config,r));case Im:return f(Yr(e,t.patch),I(i=>f(t.load(i,s,r),I(o=>{if(o.length===0){const c=f(hf(i),Wt(()=>"<n/a>"));return W(te([],`Expected ${s.description} with name ${c}`))}return C(o)}))));case Om:return f(Yr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(Um),I(o=>o.length===0?G(()=>ct(it(t,e,s.config,!0),ft)):f(Bt(o,c=>it(t,of(e,`[${c}]`),s.config,!0)),ct(c=>{const a=wf(c);return a.length===0?ft(de()):ft(a)}))))));case Em:return G(()=>f(Yr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(o=>f(o,Bt(c=>it(t,sr(i,ft(c)),s.valueConfig,r)),ct(c=>c.length===0?ft(ai()):f(qm(c),ie(a=>ld(Gi(B(o),a)))))))))));case $m:return G(()=>f(it(t,e,s.left,r),Ss,I(i=>f(it(t,e,s.right,r),Ss,I(o=>{if(We(i)&&We(o))return W(au(i.left,o.left));if(We(i)&&$n(o))return W(i.left);if($n(i)&&We(o))return W(o.left);if($n(i)&&$n(o)){const c=f(e,Te(".")),a=Lm(e,c),[l,d]=Pm(a,a,f(i.right,ie(Mt)),f(o.right,ie(Mt)));return f(l,Gi(d),Bt(([h,p])=>f(Da(h,p),ct(([g,m])=>s.zip(g,m)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},Lm=(t,e)=>n=>fe(te(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),jm=(t,e)=>t.split(new RegExp(`\\s*${Of(e)}\\s*`)),Dm=(t,e,n,r,s)=>s?f(jm(t,r),Bt(i=>n.parse(i.trim())),Tr(Kt(e))):f(n.parse(t),xa({onFailure:Kt(e),onSuccess:ft})),qm=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),Um=t=>f(Bt(t,Vm),xa({onFailure:()=>de(),onSuccess:Yn(Ze)}),Ss,ct(Hl)),Bm=/^(\[(\d+)\])$/,Vm=t=>{const e=t.match(Bm);if(e!==null){const n=e[2];return f(n!==void 0&&n.length>0?M(n):S(),Xl(Km))}return S()},Km=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?S():M(e)},Ro=Symbol.for("effect/Console"),lu=Ce("effect/Console"),Jm={[Ro]:Ro,assert(t,...e){return b(()=>{console.assert(t,...e)})},clear:b(()=>{console.clear()}),count(t){return b(()=>{console.count(t)})},countReset(t){return b(()=>{console.countReset(t)})},debug(...t){return b(()=>{console.debug(...t)})},dir(t,e){return b(()=>{console.dir(t,e)})},dirxml(...t){return b(()=>{console.dirxml(...t)})},error(...t){return b(()=>{console.error(...t)})},group(t){return t?.collapsed?b(()=>console.groupCollapsed(t?.label)):b(()=>console.group(t?.label))},groupEnd:b(()=>{console.groupEnd()}),info(...t){return b(()=>{console.info(...t)})},log(...t){return b(()=>{console.log(...t)})},table(t,e){return b(()=>{console.table(t,e)})},time(t){return b(()=>console.time(t))},timeEnd(t){return b(()=>console.timeEnd(t))},timeLog(t,...e){return b(()=>{console.timeLog(t,...e)})},trace(...t){return b(()=>{console.trace(...t)})},warn(...t){return b(()=>{console.warn(...t)})},unsafe:console},Hm="effect/Random",To=Symbol.for(Hm),Gm=Ce("effect/Random");class Wm{seed;[To]=To;PRNG;constructor(e){this.seed=e,this.PRNG=new bl(e)}get next(){return b(()=>this.PRNG.number())}get nextBoolean(){return ct(this.next,e=>e>.5)}get nextInt(){return b(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return ct(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return b(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return Ym(e,n=>this.nextIntBetween(0,n))}}const Ym=(t,e)=>G(()=>f(b(()=>Array.from(t)),I(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return f(r,_i(s=>f(e(s),ct(i=>zm(n,s-1,i)))),bn(Fc(n)))}))),zm=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},Qm=t=>new Wm(_(t)),Co=Symbol.for("effect/Tracer"),Xm=t=>({[Co]:Co,...t}),fu=Ce("effect/Tracer"),hu=Ce("effect/ParentSpan"),Fo=(function(){const t="abcdef0123456789",e=t.length;return function(n){let r="";for(let s=0;s<n;s++)r+=t.charAt(Math.floor(Math.random()*e));return r}})();class Zm{name;parent;context;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];links;constructor(e,n,r,s,i,o){this.name=e,this.parent=n,this.context=r,this.startTime=i,this.kind=o,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Fo(32),this.spanId=Fo(16),this.links=Array.from(s)}end(e,n){this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}}attribute(e,n){this.attributes.set(e,n)}event(e,n,r){this.events.push([e,n,r??{}])}addLinks(e){this.links.push(...e)}}const t_=Xm({span:(t,e,n,r,s,i)=>new Zm(t,e,n,r,s,i),context:t=>t()}),e_=f(zs(),Ve(Oi,fm()),Ve(lu,Jm),Ve(Gm,Qm(Math.random())),Ve(Rm,Am()),Ve(fu,t_)),ir=R(Symbol.for("effect/DefaultServices/currentServices"),()=>Ga(e_));function n_(t){return new xt(t)}function r_(){return n_(new Map)}const No=Symbol.for("effect/FiberRefs");class xt{locals;[No]=No;constructor(e){this.locals=e}pipe(){return y(this,arguments)}}const s_=(t,e,n,r=!1)=>{const s=t;let i=e,o=n,c=r,a;for(;a===void 0;)if(tt(i)&&tt(o)){const l=X(i)[0],d=he(i),h=X(o)[0],p=X(o)[1],g=he(o);l.startTimeMillis<h.startTimeMillis?(o=g,c=!0):l.startTimeMillis>h.startTimeMillis?i=d:l.id<h.id?(o=g,c=!0):l.id>h.id?i=d:a=[p,c]}else a=[s.initial,!0];return a},i_=u(3,(t,e,n)=>{const r=new Map(t.locals);return n.locals.forEach((s,i)=>{const o=s[0][1];if(!s[0][0][k](e)){if(!r.has(i)){if(v(o,i.initial))return;r.set(i,[[e,i.join(i.initial,o)]]);return}const c=r.get(i),[a,l]=s_(i,c,s);if(l){const d=i.diff(a,o),h=c[0][1],p=i.join(h,i.patch(d)(h));if(!v(h,p)){let g;const m=c[0][0];m[k](e)?g=[[m,p],...c.slice(1)]:g=[[e,p],...c],r.set(i,g)}}}}),new xt(r)}),o_=u(2,(t,e)=>{const n=new Map;return du(t,n,e),new xt(n)}),du=(t,e,n)=>{t.locals.forEach((r,s)=>{const i=r[0][1],o=s.patch(s.fork)(i);v(i,o)?e.set(s,r):e.set(s,[[n,o],...r])})},pu=u(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new xt(n)}),c_=u(2,(t,e)=>t.locals.has(e)?M(X(t.locals.get(e))[1]):S()),cn=u(2,(t,e)=>f(c_(t,e),Wt(()=>e.initial))),ws=u(2,(t,{fiberId:e,fiberRef:n,value:r})=>{if(t.locals.size===0)return new xt(new Map([[n,[[e,r]]]]));const s=new Map(t.locals);return Is(s,e,n,r),new xt(s)}),Is=(t,e,n,r)=>{const s=t.get(n)??[];let i;if(tt(s)){const[o,c]=X(s);if(o[k](e)){if(v(c,r))return;i=[[e,r],...s.slice(1)]}else i=[[e,r],...s]}else i=[[e,r]];t.set(n,i)},a_=u(2,(t,{entries:e,forkAs:n})=>{if(t.locals.size===0)return new xt(new Map(e));const r=new Map(t.locals);return n!==void 0&&du(t,r,n),e.forEach(([s,i])=>{i.length===1?Is(r,i[0][0],s,i[0][1]):i.forEach(([o,c])=>{Is(r,o,s,c)})}),new xt(r)}),u_=cn,l_=a_,f_=r_,h_=Eg,d_=$g,p_=Mg,g_=Va,m_=Ka,__=Ja,y_=Rg,b_=Tg,S_=f(Ze,Wl(t=>t.ordinal)),k_=Yl(S_),v_=t=>{switch(t){case"All":return h_;case"Debug":return __;case"Error":return p_;case"Fatal":return d_;case"Info":return m_;case"Trace":return y_;case"None":return b_;case"Warning":return g_}},gu=t=>t.replace(/[\s="]/g,"_"),w_=t=>e=>`${gu(e.label)}=${t-e.startTime}ms`,I_=fn,O_=Ll;class E_ extends O_{}const mu="Empty",_u="Add",yu="Remove",bu="Update",Su="AndThen",$_={_tag:mu},M_=(t,e)=>{const n=new Map(t.locals);let r=$_;for(const[s,i]of e.locals.entries()){const o=X(i)[1],c=n.get(s);if(c!==void 0){const a=X(c)[1];v(a,o)||(r=zr({_tag:bu,fiberRef:s,patch:s.diff(a,o)})(r))}else r=zr({_tag:_u,fiberRef:s,value:o})(r);n.delete(s)}for(const[s]of n.entries())r=zr({_tag:yu,fiberRef:s})(r);return r},zr=u(2,(t,e)=>({_tag:Su,first:t,second:e})),R_=u(3,(t,e,n)=>{let r=n,s=ft(t);for(;tt(s);){const i=X(s),o=he(s);switch(i._tag){case mu:{s=o;break}case _u:{r=ws(r,{fiberId:e,fiberRef:i.fiberRef,value:i.value}),s=o;break}case yu:{r=pu(r,i.fiberRef),s=o;break}case bu:{const c=cn(r,i.fiberRef);r=ws(r,{fiberId:e,fiberRef:i.fiberRef,value:i.fiberRef.patch(i.patch)(c)}),s=o;break}case Su:{s=Wn(i.first)(Wn(i.second)(o));break}}}return r}),ku="effect/MetricLabel",Os=Symbol.for(ku);class T_{key;value;[Os]=Os;_hash;constructor(e,n){this.key=e,this.value=n,this._hash=x(ku+this.key+this.value)}[w](){return this._hash}[k](e){return F_(e)&&this.key===e.key&&this.value===e.value}pipe(){return y(this,arguments)}}const C_=(t,e)=>new T_(t,e),F_=t=>O(t,Os),N_=t=>{let e,n;typeof t=="function"?e=t:(e=t.try,n=t.catch);const r=s=>n?gi(()=>n(s)):W(new Qa(s,"An unknown error occurred in Effect.tryPromise"));return e.length>=1?Zt((s,i)=>{try{e(i).then(o=>s(C(o)),o=>s(r(o)))}catch(o){s(r(o))}}):Zt(s=>{try{e().then(i=>s(C(i)),i=>s(r(i)))}catch(i){s(r(i))}})},A_="Sequential",P_={_tag:A_},x_=M_,L_=R_,Ar="effect/FiberStatus",ee=Symbol.for(Ar),or="Done",Ao="Running",Po="Suspended",j_=x(`${Ar}-${or}`);class D_{[ee]=ee;_tag=or;[w](){return j_}[k](e){return Ei(e)&&e._tag===or}}class q_{runtimeFlags;[ee]=ee;_tag=Ao;constructor(e){this.runtimeFlags=e}[w](){return f(_(Ar),E(_(this._tag)),E(_(this.runtimeFlags)),N(this))}[k](e){return Ei(e)&&e._tag===Ao&&this.runtimeFlags===e.runtimeFlags}}class U_{runtimeFlags;blockingOn;[ee]=ee;_tag=Po;constructor(e,n){this.runtimeFlags=e,this.blockingOn=n}[w](){return f(_(Ar),E(_(this._tag)),E(_(this.runtimeFlags)),E(_(this.blockingOn)),N(this))}[k](e){return Ei(e)&&e._tag===Po&&this.runtimeFlags===e.runtimeFlags&&v(this.blockingOn,e.blockingOn)}}const B_=new D_,V_=t=>new q_(t),K_=(t,e)=>new U_(t,e),Ei=t=>O(t,ee),J_=t=>t._tag===or,H_=B_,vu=V_,G_=K_,W_=J_,Y_=Symbol.for("effect/Micro"),cr=Symbol.for("effect/Micro/MicroExit"),xo=Symbol.for("effect/Micro/MicroCause"),z_={_E:U};class wu extends globalThis.Error{_tag;traces;[xo];constructor(e,n,r){const s=`MicroCause.${e}`;let i,o,c;if(n instanceof globalThis.Error){i=`(${s}) ${n.name}`,o=n.message;const a=o.split(`
`).length;c=n.stack?`(${s}) ${n.stack.split(`
`).slice(0,a+3).join(`
`)}`:`${i}: ${o}`}else i=s,o=ue(n,0),c=`${i}: ${o}`;r.length>0&&(c+=`
    ${r.join(`
    `)}`),super(o),this._tag=e,this.traces=r,this[xo]=z_,this.name=i,this.stack=c}pipe(){return y(this,arguments)}toString(){return this.stack}[A](){return this.stack}}class Q_ extends wu{defect;constructor(e,n=[]){super("Die",e,n),this.defect=e}}const X_=(t,e=[])=>new Q_(t,e);class Z_ extends wu{constructor(e=[]){super("Interrupt","interrupted",e)}}const ty=(t=[])=>new Z_(t),ey=t=>t._tag==="Interrupt",Lo=Symbol.for("effect/Micro/MicroFiber"),ny={_A:U,_E:U};class ry{context;interruptible;[Lo];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(e,n=!0){this.context=e,this.interruptible=n,this[Lo]=ny}getRef(e){return qf(this.context,e)}addObserver(e){return this._exit?(e(this._exit),ol):(this._observers.push(e),()=>{const n=this._observers.indexOf(e);n>=0&&this._observers.splice(n,1)})}_interrupted=!1;unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(Ci))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(e);if(n===Cn)return;const r=jo.interruptChildren&&jo.interruptChildren(this);if(r!==void 0)return this.evaluate(ur(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(e){let n=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(Fi).shouldYield(this)){n=!0;const s=r;r=ur(ay,()=>s)}if(r=r[Es](this),r===Cn){const s=this._yielded;return cr in s?(this._yielded=void 0,s):Cn}}}catch(s){return O(r,Es)?$s(s):$s(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(e){for(;;){const n=this._stack.pop();if(!n)return;const r=n[ar]&&n[ar](this);if(r)return{[e]:r};if(n[e])return n}}_yielded=void 0;yieldWith(e){return this._yielded=e,Cn}children(){return this._children??=new Set}}const jo=R("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Iu=Symbol.for("effect/Micro/identifier"),D=Symbol.for("effect/Micro/args"),Es=Symbol.for("effect/Micro/evaluate"),Re=Symbol.for("effect/Micro/successCont"),ae=Symbol.for("effect/Micro/failureCont"),ar=Symbol.for("effect/Micro/ensureCont"),Cn=Symbol.for("effect/Micro/Yield"),sy={_A:U,_E:U,_R:U},iy={...I_,_op:"Micro",[Y_]:sy,pipe(){return y(this,arguments)},[Symbol.iterator](){return new zo(new an(this))},toJSON(){return{_id:"Micro",op:this[Iu],...D in this?{args:this[D]}:void 0}},toString(){return V(this)},[A](){return V(this)}};function oy(t){return $s("Micro.evaluate: Not implemented")}const Pr=t=>({...iy,[Iu]:t.op,[Es]:t.eval??oy,[Re]:t.contA,[ae]:t.contE,[ar]:t.ensure}),$i=t=>{const e=Pr(t);return function(){const n=Object.create(e);return n[D]=t.single===!1?arguments:arguments[0],n}},Ou=t=>{const e={...Pr(t),[cr]:cr,_tag:t.op,get[t.prop](){return this[D]},toJSON(){return{_id:"MicroExit",_tag:t.op,[t.prop]:this[D]}},[k](n){return fy(n)&&n._tag===t.op&&v(this[D],n[D])},[w](){return N(this,E(x(t.op))(_(this[D])))}};return function(n){const r=Object.create(e);return r[D]=n,r[Re]=void 0,r[ae]=void 0,r[ar]=void 0,r}},Mi=Ou({op:"Success",prop:"value",eval(t){const e=t.getCont(Re);return e?e[Re](this[D],t):t.yieldWith(this)}}),Eu=Ou({op:"Failure",prop:"cause",eval(t){let e=t.getCont(ae);for(;ey(this[D])&&e&&t.interruptible;)e=t.getCont(ae);return e?e[ae](this[D],t):t.yieldWith(this)}}),cy=$i({op:"Yield",eval(t){let e=!1;return t.getRef(Fi).scheduleTask(()=>{e||t.evaluate(hy)},this[D]??0),t.yieldWith(()=>{e=!0})}}),ay=cy(0),uy=Mi(void 0),Ri=$i({op:"WithMicroFiber",eval(t){return this[D](t)}}),ur=u(2,(t,e)=>{const n=Object.create(ly);return n[D]=t,n[Re]=e,n}),ly=Pr({op:"OnSuccess",eval(t){return t._stack.push(this),this[D]}}),fy=t=>O(t,cr),$u=Mi,Ti=Eu,Ci=Ti(ty()),$s=t=>Ti(X_(t)),hy=$u(void 0),dy="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class Mu{tasks=[];running=!1;scheduleTask(e,n){this.tasks.push(e),this.running||(this.running=!0,dy(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const e=this.tasks;this.tasks=[];for(let n=0,r=e.length;n<r;n++)e[n]()}shouldYield(e){return e.currentOpCount>=e.getRef(my)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const py=u(2,(t,e)=>Ri(n=>{const r=n.context;return n.context=e(r),by(t,()=>(n.context=r,uy))})),gy=u(2,(t,e)=>py(t,Jf(e)));class my extends Mc()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class Fi extends Mc()("effect/Micro/currentScheduler",{defaultValue:()=>new Mu}){}const _y=u(2,(t,e)=>{const n=Object.create(yy);return n[D]=t,n[Re]=e.onSuccess,n[ae]=e.onFailure,n}),yy=Pr({op:"OnSuccessAndFailure",eval(t){return t._stack.push(this),this[D]}}),by=u(2,(t,e)=>ky(n=>_y(n(t),{onFailure:r=>ur(e(Ti(r)),()=>Eu(r)),onSuccess:r=>ur(e($u(r)),()=>Mi(r))}))),Ru=$i({op:"SetInterruptible",ensure(t){if(t.interruptible=this[D],t._interrupted&&t.interruptible)return()=>Ci}}),Sy=t=>Ri(e=>e.interruptible?t:(e.interruptible=!0,e._stack.push(Ru(!1)),e._interrupted?Ci:t)),ky=t=>Ri(e=>e.interruptible?(e.interruptible=!1,e._stack.push(Ru(!0)),t(Sy)):t(U)),vy=(t,e)=>{const n=new ry(Fi.context(new Mu));return n.evaluate(t),n};class wy{buckets=[];scheduleTask(e,n){const r=this.buckets.length;let s,i=0;for(;i<r&&this.buckets[i][0]<=n;i++)s=this.buckets[i];s&&s[0]===n?s[1].push(e):i===r?this.buckets.push([n,[e]]):this.buckets.splice(i,0,[n,[e]])}}class Iy{maxNextTickBeforeTimer;running=!1;tasks=new wy;constructor(e){this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let i=0;i<s.length;i++)s[i]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(jg)?e.getFiberRef(wi):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const Oy=R(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new Iy(2048)),Tu=R(Symbol.for("effect/FiberRef/currentScheduler"),()=>lt(Oy)),Cu=R(Symbol.for("effect/FiberRef/currentRequestMap"),()=>lt(new Map)),Ni="InterruptSignal",Ai="Stateful",Pi="Resume",xi="YieldNow",Qr=t=>({_tag:Ni,cause:t}),Un=t=>({_tag:Ai,onFiber:t}),re=t=>({_tag:Pi,effect:t}),Ey=()=>({_tag:xi}),$y="effect/FiberScope",lr=Symbol.for($y);class My{[lr]=lr;fiberId=Se;roots=new Set;add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}class Ry{fiberId;parent;[lr]=lr;constructor(e,n){this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(Un(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const Ty=t=>new Ry(t.id(),t),Li=R(Symbol.for("effect/FiberScope/Global"),()=>new My),Cy="effect/Fiber",Fy=Symbol.for(Cy),Ny={_E:t=>t,_A:t=>t},Ay="effect/Fiber",Py=Symbol.for(Ay),Fu=t=>qa(Aa(t.await),t.inheritAll);({...hn});const jt="effect/FiberCurrent",xy="effect/Logger",Ly=Symbol.for(xy),jy={_Message:t=>t,_Output:t=>t},ji=t=>({[Ly]:jy,log:t,pipe(){return y(this,arguments)}}),Dy=/^[^\s"=]*$/,qy=(t,e)=>({annotations:n,cause:r,date:s,fiberId:i,logLevel:o,message:c,spans:a})=>{const l=m=>m.match(Dy)?m:t(m),d=(m,$)=>`${gu(m)}=${l($)}`,h=(m,$)=>" "+d(m,$);let p=d("timestamp",s.toISOString());p+=h("level",o.label),p+=h("fiber",Zc(i));const g=sf(c);for(let m=0;m<g.length;m++)p+=h("message",ue(g[m],e));Jp(r)||(p+=h("cause",_n(r,{renderErrorCause:!0})));for(const m of a)p+=" "+w_(s.getTime())(m);for(const[m,$]of n)p+=h(m,ue($,e));return p},Uy=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,By=ji(qy(Uy)),Vy=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null;Vy&&process.stdout.isTTY;const Nu="effect/MetricBoundaries",Ms=Symbol.for(Nu);class Ky{values;[Ms]=Ms;constructor(e){this.values=e,this._hash=f(x(Nu),E(un(this.values)))}_hash;[w](){return this._hash}[k](e){return Jy(e)&&v(this.values,e.values)}pipe(){return y(this,arguments)}}const Jy=t=>O(t,Ms),Hy=t=>{const e=f(t,_c(et(Number.POSITIVE_INFINITY)),If);return new Ky(e)},Gy=t=>f(rf(t.count-1,e=>t.start*Math.pow(t.factor,e)),yr,Hy),Wy="effect/MetricKeyType",Au=Symbol.for(Wy),Pu="effect/MetricKeyType/Counter",Rs=Symbol.for(Pu),Yy="effect/MetricKeyType/Frequency",zy=Symbol.for(Yy),Qy="effect/MetricKeyType/Gauge",Xy=Symbol.for(Qy),xu="effect/MetricKeyType/Histogram",Ts=Symbol.for(xu),Zy="effect/MetricKeyType/Summary",tb=Symbol.for(Zy),Lu={_In:t=>t,_Out:t=>t};class eb{incremental;bigint;[Au]=Lu;[Rs]=Rs;constructor(e,n){this.incremental=e,this.bigint=n,this._hash=x(Pu)}_hash;[w](){return this._hash}[k](e){return ju(e)}pipe(){return y(this,arguments)}}class nb{boundaries;[Au]=Lu;[Ts]=Ts;constructor(e){this.boundaries=e,this._hash=f(x(xu),E(_(this.boundaries)))}_hash;[w](){return this._hash}[k](e){return Du(e)&&v(this.boundaries,e.boundaries)}pipe(){return y(this,arguments)}}const rb=t=>new eb(t?.incremental??!1,t?.bigint??!1),sb=t=>new nb(t),ju=t=>O(t,Rs),ib=t=>O(t,zy),ob=t=>O(t,Xy),Du=t=>O(t,Ts),cb=t=>O(t,tb),ab="effect/MetricKey",qu=Symbol.for(ab),ub={_Type:t=>t},lb=Ws(v);class Di{name;keyType;description;tags;[qu]=ub;constructor(e,n,r,s=[]){this.name=e,this.keyType=n,this.description=r,this.tags=s,this._hash=f(x(this.name+this.description),E(_(this.keyType)),E(un(this.tags)))}_hash;[w](){return this._hash}[k](e){return fb(e)&&this.name===e.name&&v(this.keyType,e.keyType)&&v(this.description,e.description)&&lb(this.tags,e.tags)}pipe(){return y(this,arguments)}}const fb=t=>O(t,qu),hb=(t,e)=>new Di(t,rb(e),Hs(e?.description)),db=(t,e,n)=>new Di(t,sb(e),Hs(n)),pb=u(2,(t,e)=>e.length===0?t:new Di(t.name,t.keyType,t.description,xn(t.tags,e))),gb="effect/MetricState",kn=Symbol.for(gb),Uu="effect/MetricState/Counter",Cs=Symbol.for(Uu),Bu="effect/MetricState/Frequency",Fs=Symbol.for(Bu),Vu="effect/MetricState/Gauge",Ns=Symbol.for(Vu),Ku="effect/MetricState/Histogram",As=Symbol.for(Ku),Ju="effect/MetricState/Summary",Ps=Symbol.for(Ju),vn={_A:t=>t};class mb{count;[kn]=vn;[Cs]=Cs;constructor(e){this.count=e}[w](){return f(_(Uu),E(_(this.count)),N(this))}[k](e){return $b(e)&&this.count===e.count}pipe(){return y(this,arguments)}}const _b=Ws(v);class yb{occurrences;[kn]=vn;[Fs]=Fs;constructor(e){this.occurrences=e}_hash;[w](){return f(x(Bu),E(un(B(this.occurrences.entries()))),N(this))}[k](e){return Mb(e)&&_b(B(this.occurrences.entries()),B(e.occurrences.entries()))}pipe(){return y(this,arguments)}}class bb{value;[kn]=vn;[Ns]=Ns;constructor(e){this.value=e}[w](){return f(_(Vu),E(_(this.value)),N(this))}[k](e){return Rb(e)&&this.value===e.value}pipe(){return y(this,arguments)}}class Sb{buckets;count;min;max;sum;[kn]=vn;[As]=As;constructor(e,n,r,s,i){this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=i}[w](){return f(_(Ku),E(_(this.buckets)),E(_(this.count)),E(_(this.min)),E(_(this.max)),E(_(this.sum)),N(this))}[k](e){return Tb(e)&&v(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}class kb{error;quantiles;count;min;max;sum;[kn]=vn;[Ps]=Ps;constructor(e,n,r,s,i,o){this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=i,this.sum=o}[w](){return f(_(Ju),E(_(this.error)),E(_(this.quantiles)),E(_(this.count)),E(_(this.min)),E(_(this.max)),E(_(this.sum)),N(this))}[k](e){return Cb(e)&&this.error===e.error&&v(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}const vb=t=>new mb(t),wb=t=>new yb(t),Ib=t=>new bb(t),Ob=t=>new Sb(t.buckets,t.count,t.min,t.max,t.sum),Eb=t=>new kb(t.error,t.quantiles,t.count,t.min,t.max,t.sum),$b=t=>O(t,Cs),Mb=t=>O(t,Fs),Rb=t=>O(t,Ns),Tb=t=>O(t,As),Cb=t=>O(t,Ps),Fb="effect/MetricHook",Nb=Symbol.for(Fb),Ab={_In:t=>t,_Out:t=>t},wn=t=>({[Nb]:Ab,pipe(){return y(this,arguments)},...t}),Do=BigInt(0),Pb=t=>{let e=t.keyType.bigint?Do:0;const n=t.keyType.incremental?t.keyType.bigint?s=>s>=Do:s=>s>=0:s=>!0,r=s=>{n(s)&&(e=e+s)};return wn({get:()=>vb(e),update:r,modify:r})},xb=t=>{const e=new Map;for(const r of t.keyType.preregisteredWords)e.set(r,0);const n=r=>{const s=e.get(r)??0;e.set(r,s+1)};return wn({get:()=>wb(e),update:n,modify:n})},Lb=(t,e)=>{let n=e;return wn({get:()=>Ib(n),update:r=>{n=r},modify:r=>{n=n+r}})},jb=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float64Array(n);let i=0,o=0,c=Number.MAX_VALUE,a=Number.MIN_VALUE;f(e,Yn(Ze),ie((h,p)=>{s[p]=h}));const l=h=>{let p=0,g=n;for(;p!==g;){const m=Math.floor(p+(g-p)/2),$=s[m];h<=$?g=m:p=m,g===p+1&&(h<=s[p]?g=p:p=g)}r[p]=r[p]+1,i=i+1,o=o+h,h<c&&(c=h),h>a&&(a=h)},d=()=>{const h=Gs(n);let p=0;for(let g=0;g<n;g++){const m=s[g],$=r[g];p=p+$,h[g]=[m,p]}return h};return wn({get:()=>Ob({buckets:d(),count:i,min:c,max:a,sum:o}),update:l,modify:l})},Db=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,i=f(s,Yn(Ze)),o=Gs(r);let c=0,a=0,l=0,d=0,h=0;const p=m=>{const $=[];let F=0;for(;F!==r-1;){const K=o[F];if(K!=null){const[J,wt]=K,nt=cs(m-J);_h(nt,xc)&&mh(nt,n)&&$.push(wt)}F=F+1}return qb(e,i,Yn($,Ze))},g=(m,$)=>{if(r>0){c=c+1;const F=c%r;o[F]=[$,m]}d=a===0?m:Math.min(d,m),h=a===0?m:Math.max(h,m),a=a+1,l=l+m};return wn({get:()=>Eb({error:e,quantiles:p(Date.now()),count:a,min:d,max:h,sum:l}),update:([m,$])=>g(m,$),modify:([m,$])=>g(m,$)})},qb=(t,e,n)=>{const r=n.length;if(!tt(e))return de();const s=e[0],i=e.slice(1),o=qo(t,r,S(),0,s,n),c=ft(o);return i.forEach(a=>{c.push(qo(t,r,o.value,o.consumed,a,o.rest))}),ie(c,a=>[a.quantile,a.value])},qo=(t,e,n,r,s,i)=>{let o=t,c=e,a=n,l=r,d=s,h=i,p=t,g=e,m=n,$=r,F=s,K=i;for(;;){if(!tt(h))return{quantile:d,value:S(),consumed:l,rest:[]};if(d===1)return{quantile:d,value:M(Sc(h)),consumed:l+h.length,rest:[]};const J=X(h),wt=pf(h,P=>P===J),nt=d*c,De=o/2*nt,It=l+wt[0].length,In=Math.abs(It-nt);if(It<nt-De){p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}if(It>nt+De){const P=Q(a)?M(J):a;return{quantile:d,value:P,consumed:l,rest:h}}switch(a._tag){case"None":{p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}case"Some":{const P=Math.abs(nt-a.value);if(In<P){p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}return{quantile:d,value:M(a.value),consumed:l,rest:h}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},Ub="effect/MetricPair",Bb=Symbol.for(Ub),Vb={_Type:t=>t},Kb=(t,e)=>({[Bb]:Vb,metricKey:t,metricState:e,pipe(){return y(this,arguments)}}),Jb="effect/MetricRegistry",Uo=Symbol.for(Jb);class Hb{[Uo]=Uo;map=sm();snapshot(){const e=[];for(const[n,r]of this.map)e.push(Kb(n,r.get()));return e}get(e){const n=f(this.map,qt(e),Dt);if(n==null){if(ju(e.keyType))return this.getCounter(e);if(ob(e.keyType))return this.getGauge(e);if(ib(e.keyType))return this.getFrequency(e);if(Du(e.keyType))return this.getHistogram(e);if(cb(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Pb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getFrequency(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=xb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getGauge(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Lb(e,e.keyType.bigint?BigInt(0):0);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getHistogram(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=jb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getSummary(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Db(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}}const Gb=()=>new Hb,Wb="effect/Metric",Yb=Symbol.for(Wb),zb={_Type:t=>t,_In:t=>t,_Out:t=>t},Bo=R(Symbol.for("effect/Metric/globalMetricRegistry"),()=>Gb()),Hu=function(t,e,n,r){const s=Object.assign(i=>vg(i,o=>tS(s,o)),{[Yb]:zb,keyType:t,unsafeUpdate:e,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return y(this,arguments)}});return s},xr=(t,e)=>Gu(hb(t,e)),Gu=t=>{let e;const n=new WeakMap,r=s=>{if(s.length===0)return e!==void 0||(e=Bo.get(t)),e;let i=n.get(s);return i!==void 0||(i=Bo.get(pb(t,s)),n.set(s,i)),i};return Hu(t.keyType,(s,i)=>r(i).update(s),s=>r(s).get(),(s,i)=>r(i).modify(s))},Qb=(t,e,n)=>Gu(db(t,e,n)),Xb=u(3,(t,e,n)=>Zb(t,[C_(e,n)])),Zb=u(2,(t,e)=>Hu(t.keyType,(n,r)=>t.unsafeUpdate(n,xn(e,r)),n=>t.unsafeValue(xn(e,n)),(n,r)=>t.unsafeModify(n,xn(e,r)))),tS=u(2,(t,e)=>Ha(ks,n=>b(()=>t.unsafeUpdate(e,n))));({...Ks});const eS=u(2,(t,e)=>Ha(Cu,n=>b(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,tu(r.result,e))}}))),nS="effect/Supervisor",Lr=Symbol.for(nS),qi={_T:t=>t};class jr{underlying;value0;[Lr]=qi;constructor(e,n){this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}}class Dr{left;right;_tag="Zip";[Lr]=qi;constructor(e,n){this.left=e,this.right=n}get value(){return Da(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}}const Wu=t=>O(t,Lr)&&Yo(t,"Zip");class rS{effect;[Lr]=qi;constructor(e){this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}onRun(e,n){return e()}}const sS=t=>new rS(t),qr=R("effect/Supervisor/none",()=>sS(kt)),iS=Fe,Yu="Empty",zu="AddSupervisor",Qu="RemoveSupervisor",Xu="AndThen",Xe={_tag:Yu},Bn=(t,e)=>({_tag:Xu,first:t,second:e}),oS=(t,e)=>cS(e,et(t)),cS=(t,e)=>{let n=t,r=e;for(;me(r);){const s=_e(r);switch(s._tag){case Yu:{r=Ut(r);break}case zu:{n=n.zip(s.supervisor),r=Ut(r);break}case Qu:{n=xs(n,s.supervisor),r=Ut(r);break}case Xu:{r=pt(s.first)(pt(s.second)(Ut(r)));break}}}return n},xs=(t,e)=>v(t,e)?qr:Wu(t)?xs(t.left,e).zip(xs(t.right,e)):t,fr=t=>v(t,qr)?zt():Wu(t)?f(fr(t.left),nn(fr(t.right))):oi(t),aS=(t,e)=>{if(v(t,e))return Xe;const n=fr(t),r=fr(e),s=f(r,to(n),Xn(Xe,(o,c)=>Bn(o,{_tag:zu,supervisor:c}))),i=f(n,to(r),Xn(Xe,(o,c)=>Bn(o,{_tag:Qu,supervisor:c})));return Bn(s,i)},uS=iS({empty:Xe,patch:oS,combine:Bn,diff:aS}),lS=xr("effect_fiber_started",{incremental:!0}),Vo=xr("effect_fiber_active"),fS=xr("effect_fiber_successes",{incremental:!0}),hS=xr("effect_fiber_failures",{incremental:!0}),dS=Xb(Qb("effect_fiber_lifetimes",Gy({start:.5,factor:2,count:35})),"time_unit","milliseconds"),He="Continue",pS="Done",Ko="Yield",gS={_E:t=>t,_A:t=>t},Fn=t=>{throw new Error(`BUG: FiberRuntime - ${ue(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Et=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),$t=R("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Ge={[Jn]:(t,e,n)=>z(()=>e.effect_instruction_i1(n)),OnStep:(t,e,n)=>j(j(n)),[Hn]:(t,e,n)=>z(()=>e.effect_instruction_i2(n)),[Bs]:(t,e,n)=>(t.patchRuntimeFlags(t.currentRuntimeFlags,e.patch),Nt(t.currentRuntimeFlags)&&t.isInterrupted()?T(t.getInterruptedCause()):j(n)),[Gn]:(t,e,n)=>(z(()=>e.effect_instruction_i2(n)),z(()=>e.effect_instruction_i0())?(t.pushStack(e),z(()=>e.effect_instruction_i1())):kt),[An]:(t,e,n)=>{for(;;){const r=z(()=>e.effect_instruction_i0.next(n));if(r.done)return j(r.value);const s=kl(r.value);if(Nr(s)){if(s._tag==="Failure")return s}else return t.pushStack(e),s;n=s.value}}},mS={[Ni]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Nt(e)?T(r.cause):n),[Pi]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Ai]:(t,e,n,r)=>(r.onFiber(t,vu(e)),n),[xi]:(t,e,n,r)=>I(Si(),()=>n)},_S=t=>_i(Mp(t),e=>tl(Bp(e),([n,r])=>{const s=new Map,i=[];for(const c of r){i.push(Ht(c));for(const a of c)s.set(a.request,a)}const o=i.flat();return vi(RS(n.runAll(i),o,()=>o.forEach(c=>{c.listeners.interrupted=!0})),Cu,s)},!1,!1)),yS=Vs();class Zu extends E_{[Fy]=Ny;[Py]=gS;_fiberRefs;_fiberId;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(e,n,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=e,this._fiberRefs=n,io(r)){const s=this.getFiberRef(ks);lS.unsafeUpdate(1,s),Vo.unsafeUpdate(1,s)}this.refreshRefCache()}commit(){return Fu(this)}id(){return this._fiberId}resume(e){this.tell(re(e))}get status(){return this.ask((e,n)=>n)}get runtimeFlags(){return this.ask((e,n)=>W_(n)?e.currentRuntimeFlags:n.runtimeFlags)}scope(){return Ty(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Tn)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return G(()=>{const n=tm(this._fiberId);return this.tell(Un((r,s)=>{tu(n,b(()=>e(r,s)))})),Za(n)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Zt(e=>{const n=r=>e(C(r));return this.tell(Un((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),b(()=>this.tell(Un((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return gt((e,n)=>{const r=e.id(),s=e.getFiberRefs(),i=n.runtimeFlags,o=this.getFiberRefs(),c=i_(s,r,o);e.setFiberRefs(c);const a=e.getFiberRef(Jo),l=f(Dn(i,a),co(Ne),co(ys));return Ig(l)})}get poll(){return b(()=>Hs(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return b(()=>this.tell(Qr(At(e))))}unsafeInterruptAsFork(e){this.tell(Qr(At(e)))}addObserver(e){this._exitValue!==null?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(n=>n!==e)}getFiberRefs(){return this.setFiberRef(Jo,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=pu(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,n){this._fiberRefs=ws(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:n}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(ir),this.currentTracer=this.currentDefaultServices.unsafeMap.get(fu.key),this.currentSupervisor=this.getFiberRef(MS),this.currentScheduler=this.getFiberRef(Tu),this.currentContext=this.getFiberRef(Fr),this.currentSpan=this.currentContext.unsafeMap.get(hu.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}transferChildren(e){const n=this._children;if(this._children=null,n!==null&&n.size>0)for(const r of n)r._exitValue===null&&e.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let n=He;const r=globalThis[jt];globalThis[jt]=this;try{for(;n===He;)n=this._queue.length===0?pS:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[jt]=r}this._queue.length>0&&!this._running?(this._running=!0,n===Ko?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(wi))}drainQueueWhileRunning(e,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=mS[s._tag](this,e,r,s)}return r}isInterrupted(){return!Hp(this.getFiberRef(Tn))}addInterruptedCause(e){const n=this.getFiberRef(Tn);this.setFiberRef(Tn,ot(n,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let e=!1;for(const n of this._children)n.tell(Qr(At(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let n=!1;return bi({while:()=>!n,body:()=>{const s=e.next();return s.done?b(()=>{n=!0}):Sn(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(io(this.currentRuntimeFlags)){const n=this.getFiberRef(ks),r=this.id().startTimeMillis,s=Date.now();switch(dS.unsafeUpdate(s-r,n),Vo.unsafeUpdate(-1,n),e._tag){case ut:{fS.unsafeUpdate(1,n);break}case at:{hS.unsafeUpdate(1,n);break}}}if(e._tag==="Failure"){const n=this.getFiberRef(Vg);!hi(e.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",e.cause,n)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](e);this._observers=[]}getLoggers(){return this.getFiberRef(wS)}log(e,n,r){const s=St(r)?r.value:this.getFiberRef(qg),i=this.getFiberRef(bS);if(k_(i,s))return;const o=this.getFiberRef(Ug),c=this.getFiberRef(Dg),a=this.getLoggers(),l=this.getFiberRefs();if(Wc(a)>0){const d=Ec(this.getFiberRef(ir),Oi),h=new Date(d.unsafeCurrentTimeMillis());El(l,()=>{for(const p of a)p.log({fiberId:this.id(),logLevel:s,message:e,cause:n,context:l,spans:o,annotations:c,date:h})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case xi:return Ko;case Ni:return this.processNewInterruptSignal(e.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(T(e.cause)),this._asyncInterruptor=null),He;case Pi:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),He;case Ai:return e.onFiber(this,this._exitValue!==null?H_:G_(this.currentRuntimeFlags,this._asyncBlockingOn)),He;default:return Fn(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let n=Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(this.getInterruptedCause()):e;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===Et){const i=$t.currentOp;$t.currentOp=null,i._op===Pn?wp(this.currentRuntimeFlags)?(this.tell(Ey()),this.tell(re(Vt)),n=null):n=Vt:i._op===Ye&&(n=null)}else{this.currentRuntimeFlags=f(this.currentRuntimeFlags,Ip(ys));const i=this.interruptAllChildren();i!==null?n=I(i,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(re(s)),n=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(re(e));else{this._running=!0;const n=globalThis[jt];globalThis[jt]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[jt]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(re(e))}patchRuntimeFlags(e,n){const r=qn(e,n);return globalThis[jt]=this,this.currentRuntimeFlags=r,r}initiateAsync(e,n){let r=!1;const s=i=>{r||(r=!0,this.tell(re(i)))};Nt(e)&&(this._asyncInterruptor=s);try{n(s)}catch(i){s(mt(Tt(i)))}}pushStack(e){this._stack.push(e),e._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const e=this._stack.pop();if(e)return e._op==="OnStep"&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==Br)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==Jn&&e._op!==Gn&&e._op!==An)return e;e=this.popStack()}}[Ml](e){return b(()=>$c(this.currentContext,e))}Left(e){return W(e.left)}None(e){return W(new za)}Right(e){return j(e.right)}Some(e){return j(e.value)}Micro(e){return rr(n=>{let r=n;const s=vy(gy(e,this.currentContext));return s.addObserver(i=>{if(i._tag==="Success")return r(j(i.value));switch(i.cause._tag){case"Interrupt":return r(T(At(Se)));case"Fail":return r(W(i.cause.error));case"Die":return r(po(i.cause.defect))}}),rr(i=>{r=o=>{i(kt)},s.unsafeInterrupt()})})}[nc](e){const n=z(()=>e.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||Fn(r),Ge[r._op](this,r,n)):($t.currentOp=j(n),Et)}[ut](e){const n=e,r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||Fn(r),Ge[r._op](this,r,n.effect_instruction_i0)):($t.currentOp=n,Et)}[at](e){const n=e.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case Br:case Hn:return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(ao(n)):z(()=>r.effect_instruction_i1(n));case"OnStep":return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(ao(n)):j(T(n));case Bs:return this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(ot(n,this.getInterruptedCause())):T(n);default:Fn(r)}else return $t.currentOp=T(n),Et}[rc](e){return z(()=>e.effect_instruction_i0(this,vu(this.currentRuntimeFlags)))}Blocked(e){const n=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){const s=[],i=this._steps[this._steps.length-1];let o=this.popStack();for(;o&&o._op!=="OnStep";)s.push(o),o=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const c=x_(i.refs,n),a=Dn(i.flags,r);return j($a(e.effect_instruction_i0,gt(l=>{for(;s.length>0;)l.pushStack(s.pop());return l.setFiberRefs(L_(l.id(),l.getFiberRefs())(c)),l.currentRuntimeFlags=qn(a)(l.currentRuntimeFlags),e.effect_instruction_i1})))}return Cr(s=>I(el(pg(e.effect_instruction_i0)),()=>s(e.effect_instruction_i1)))}RunBlocked(e){return _S(e.effect_instruction_i0)}[ln](e){const n=e.effect_instruction_i0,r=this.currentRuntimeFlags,s=qn(r,n);if(Nt(s)&&this.isInterrupted())return T(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,n),e.effect_instruction_i1){const i=Dn(s,r);return this.pushStack(new gg(i,e)),z(()=>e.effect_instruction_i1(r))}else return Vt}[Jn](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[Br](e){return this.pushStack(e),e.effect_instruction_i0}[Hn](e){return this.pushStack(e),e.effect_instruction_i0}[Ye](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),$t.currentOp=e,Et}[Pn](e){return this._isYielding=!1,$t.currentOp=e,Et}[Gn](e){const n=e.effect_instruction_i0,r=e.effect_instruction_i1;return n()?(this.pushStack(e),r()):Vt}[An](e){return Ge[An](this,e,void 0)}[_r](e){return z(()=>e.commit())}runLoop(e){let n=e;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&vp)!==0&&this.currentSupervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this.currentRuntimeFlags,n)),!this._isYielding){this.currentOpCount+=1;const r=this.currentScheduler.shouldYield(this);if(r!==!1){this._isYielding=!0,this.currentOpCount=0;const s=n;n=I(Si({priority:r}),()=>s)}}try{if(n=this.currentTracer.context(()=>{if(yS!==n[$e]._V){const r=this.getFiberRef(Kg);if(r._tag==="Some"){const s=n[$e]._V;this.log(`Executing an Effect versioned ${s} with a Runtime of version ${Vs()}, you may want to dedupe the effect dependencies, you can use the language service plugin to detect this at compile time: https://github.com/Effect-TS/language-service`,Ie,r)}}return this[n._op](n)},this),n===Et){const r=$t.currentOp;return r._op===Pn||r._op===Ye?Et:($t.currentOp=null,r._op===ut||r._op===at?r:T(Tt(r)))}}catch(r){n!==Et&&!O(n,"_op")||!(n._op in this)?n=yg(`Not a valid effect: ${ue(n)}`):zg(r)?n=T(ot(Tt(r),At(Se))):n=po(r)}}}run=()=>{this.drainQueueOnCurrentThread()}}const bS=R("effect/FiberRef/currentMinimumLogLevel",()=>lt(v_("Info"))),SS=t=>ji(e=>{const n=u_(e.context,ir);Ec(n,lu).unsafe.log(t.log(e))}),kS=R(Symbol.for("effect/Logger/defaultLogger"),()=>SS(By)),vS=R(Symbol.for("effect/Logger/tracerLogger"),()=>ji(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:i})=>{const o=Kf(cn(n,Fr),hu);if(o._tag==="None"||o.value._tag==="ExternalSpan")return;const c=$c(cn(n,ir),Oi),a={};for(const[l,d]of t)a[l]=d;a["effect.fiberId"]=ud(r),a["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(a["effect.cause"]=_n(e,{renderErrorCause:!0})),o.value.event(ue(Array.isArray(i)&&i.length===1?i[0]:i),c.unsafeCurrentTimeNanos(),a)})),wS=R(Symbol.for("effect/FiberRef/currentLoggers"),()=>Pg(oi(kS,vS))),tl=(t,e,n,r,s)=>Cr(i=>wg(o=>gt(c=>{let a=Array.from(t).reverse(),l=a.length;if(l===0)return kt;let d=0,h=!1;const p=a.length,g=new Set,m=new Array,$=()=>g.forEach(P=>{P.currentScheduler.scheduleTask(()=>{P.unsafeInterruptAsFork(c.id())},0)}),F=new Array,K=new Array,J=new Array,wt=()=>{const P=m.filter(({exit:Z})=>Z._tag==="Failure").sort((Z,_t)=>Z.index<_t.index?-1:Z.index===_t.index?0:1).map(({exit:Z})=>Z);return P.length===0&&P.push(Vt),P},nt=(P,Z=!1)=>{const _t=ja(o(P)),H=OS(_t,c,c.currentRuntimeFlags,Li);return c.currentScheduler.scheduleTask(()=>{Z&&H.unsafeInterruptAsFork(c.id()),H.resume(_t)},0),H},De=()=>{r||(l-=a.length,a=[]),h=!0,$()},It=Fa,In=nt(Zt(P=>{const Z=(H,Ot)=>{H._op==="Blocked"?J.push(H):(m.push({index:Ot,exit:H}),H._op==="Failure"&&!h&&De())},_t=()=>{if(a.length>0){const H=a.pop();let Ot=d++;const On=()=>{const rt=a.pop();return Ot=d++,I(Si(),()=>I(It(i(e(rt,Ot))),Lt))},Lt=rt=>a.length>0&&(Z(rt,Ot),a.length>0)?On():C(rt),En=I(It(i(e(H,Ot))),Lt),yt=nt(En);F.push(yt),g.add(yt),h&&yt.currentScheduler.scheduleTask(()=>{yt.unsafeInterruptAsFork(c.id())},0),yt.addObserver(rt=>{let qe;if(rt._op==="Failure"?qe=rt:qe=rt.effect_instruction_i0,K.push(yt),g.delete(yt),Z(qe,Ot),m.length===l)P(C(Wt(bo(wt(),{parallel:!0}),()=>Vt)));else if(J.length+m.length===l){const Bi=wt(),sl=J.map(Ue=>Ue.effect_instruction_i0).reduce(_a);P(C($a(sl,tl([Wt(bo(Bi,{parallel:!0}),()=>Vt),...J.map(Ue=>Ue.effect_instruction_i1)],Ue=>Ue,n,!0))))}else _t()})}};for(let H=0;H<p;H++)_t()}));return Sn(yi(Aa(i(Fu(In))),Xa({onFailure:P=>{De();const Z=J.length+1,_t=Math.min(J.length,J.length),H=Array.from(J);return Zt(Ot=>{let On=0,Lt=0;const En=(rt,qe)=>Bi=>{On++,On===Z&&Ot(j(T(P))),H.length>0&&qe&&yt()},yt=()=>{nt(H.pop(),!0).addObserver(En(Lt,!0)),Lt++};In.addObserver(En(Lt,!1)),Lt++;for(let rt=0;rt<_t;rt++)yt()})},onSuccess:()=>Bt(K,P=>P.inheritAll)})))}))),el=t=>ES(t,Li),IS=(t,e,n,r=null)=>{const s=nl(t,e,n,r);return s.resume(t),s},OS=(t,e,n,r=null)=>nl(t,e,n,r),nl=(t,e,n,r=null)=>{const s=ta(),i=e.getFiberRefs(),o=o_(i,s),c=new Zu(s,o,n),a=cn(o,Fr),l=c.currentSupervisor;return l.onStart(a,t,M(e),c),c.addObserver(h=>l.onEnd(h,c)),(r!==null?r:f(e.getFiberRef(vs),Wt(()=>e.scope()))).add(n,c),c},ES=(t,e)=>gt((n,r)=>C(IS(t,n,r.runtimeFlags,e))),$S=t=>Le(t,{differ:uS,fork:Xe}),Jo=Lg(Op),MS=$S(qr),RS=(t,e,n)=>Na(r=>I(I(el(Pa(t)),s=>Zt(i=>{const o=e.map(l=>l.listeners.count),c=()=>{o.every(l=>l===0)&&e.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&Nr(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&Gp(l.result.state.current.effect.cause)))&&(a.forEach(l=>l()),n?.(),i(Og(s)))};s.addObserver(l=>{a.forEach(d=>d()),i(l)});const a=e.map((l,d)=>{const h=p=>{o[d]=p,c()};return l.listeners.addObserver(h),()=>l.listeners.removeObserver(h)});return c(),b(()=>{a.forEach(l=>l())})})),()=>G(()=>{const s=e.flatMap(i=>i.state.completed?[]:[i]);return _i(s,i=>eS(i.request,Qg(r)))}))),TS=Hg,CS=Gg,Ui=t=>function(){if(arguments.length===1){const e=arguments[0];return(n,...r)=>t(e,n,...r)}return t.apply(this,arguments)},FS=Ui((t,e,n)=>{const r=ta(),s=[[Fr,[[r,t.context]]]];n?.scheduler&&s.push([Tu,[[r,n.scheduler]]]);let i=l_(t.fiberRefs,{entries:s,forkAs:r});n?.updateRefs&&(i=n.updateRefs(i,r));const o=new Zu(r,i,t.runtimeFlags);let c=e;n?.scope&&(c=I(CS(n.scope,P_),l=>Ua(Jg(l,Na(d=>v(d,o.id())?kt:Ba(o,d))),yi(e,d=>TS(l,d)))));const a=o.currentSupervisor;return a!==qr&&(a.onStart(t.context,c,S(),o),o.addObserver(l=>a.onEnd(l,o))),Li.add(t.runtimeFlags,o),n?.immediate===!1?o.resume(c):o.start(c),o}),Xr=Symbol.for("effect/Runtime/FiberFailure"),Nn=Symbol.for("effect/Runtime/FiberFailure/Cause");class NS extends Error{[Xr];[Nn];constructor(e){const n=Oa(e)[0];super(n?.message||"An error has occurred"),this[Xr]=Xr,this[Nn]=e,this.name=n?`(FiberFailure) ${n.name}`:"FiberFailure",n?.stack&&(this.stack=n.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Nn].toJSON()}}toString(){return"(FiberFailure) "+_n(this[Nn],{renderErrorCause:!0})}[A](){return this.toString()}}const AS=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new NS(t);return Error.stackTraceLimit=e,n},PS=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return So(e.left);case"Right":return j(e.right);case"Some":return j(e.value);case"None":return So(za())}},xS=Ui((t,e,n)=>LS(t,e,n).then(r=>{switch(r._tag){case ut:return r.effect_instruction_i0;case at:throw AS(r.effect_instruction_i0)}})),LS=Ui((t,e,n)=>new Promise(r=>{const s=PS(e);s&&r(s);const i=FS(t)(e);i.addObserver(o=>{r(o)}),n?.signal!==void 0&&(n.signal.aborted?i.unsafeInterruptAsFork(i.id()):n.signal.addEventListener("abort",()=>{i.unsafeInterruptAsFork(i.id())},{once:!0}))}));class jS{context;runtimeFlags;fiberRefs;constructor(e,n,r){this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return y(this,arguments)}}const DS=t=>new jS(t.context,t.runtimeFlags,t.fiberRefs),qS=ga(Ne,da,ha),US=DS({context:zs(),runtimeFlags:qS,fiberRefs:f_()}),BS=xS(US),Ho=W,VS=C,KS=N_,JS=Tr,HS=I,XS=BS,ZS=t=>typeof t=="object"&&t!==null,t0=t=>typeof t=="string",e0=t=>t===null||typeof t=="string",n0=(t,e)=>{const n=document.getElementById(t);if(n&&e(n))return n;throw new Error(`Missing element #${t}`)},Go=(t,e)=>{t.classList.toggle("hidden",e)},r0=(t,e)=>{if(e===null){Go(t,!0),t.textContent="";return}t.textContent=e,Go(t,!1)},s0=(t,e,n)=>{const r=document.createElement("div");r.className=`toast ${n}`,r.textContent=e,t.appendChild(r),window.setTimeout(()=>{r.remove()},3200)},i0=t=>t?new Date(t).toLocaleString():"",GS=t=>typeof t=="object"&&t!==null,WS=t=>{if(!GS(t))return null;const e=t.error;return typeof e=="string"?e:null},YS=t=>t.json().then(e=>e).catch(()=>null).then(e=>({response:t,body:e})),zS=t=>({_tag:"NetworkError",reason:t instanceof Error?t.message:typeof t=="string"?t:typeof t=="number"||typeof t=="boolean"?String(t):"unknown_error"}),rl=(t,e,n)=>f(KS(()=>fetch(t,{...e,credentials:"include"}).then(YS)),JS(r=>zS(r)),HS(({response:r,body:s})=>{if(!r.ok)return Ho({_tag:"ApiError",status:r.status,error:WS(s)??"unknown_error",body:s});const i=n(s);return i?VS(i):Ho({_tag:"DecodeError",reason:"invalid_response_shape"})})),o0=(t,e)=>rl(t,{method:"GET"},e),c0=(t,e,n)=>rl(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},n);export{t0 as a,e0 as b,XS as c,s0 as d,f as e,i0 as f,o0 as g,Go as h,ZS as i,JS as m,c0 as p,n0 as r,r0 as s,KS as t};
