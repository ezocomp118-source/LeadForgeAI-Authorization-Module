import{i as j,a as u,b as st,f as R,r as m,c as O,s as S,g as rt,p as it,d as L,e as ht,m as ft,t as vt}from"./styles-Byh3MCSL.js";const k=Symbol.for("@ts-pattern/matcher"),gt=Symbol.for("@ts-pattern/isVariadic"),P="@ts-pattern/anonymous-select-key",q=t=>!!(t&&typeof t=="object"),F=t=>t&&!!t[k],g=(t,e,n)=>{if(F(t)){const s=t[k](),{matched:r,selections:i}=s.match(e);return r&&i&&Object.keys(i).forEach(l=>n(l,i[l])),r}if(q(t)){if(!q(e))return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;let s=[],r=[],i=[];for(const l of t.keys()){const d=t[l];F(d)&&d[gt]?i.push(d):i.length?r.push(d):s.push(d)}if(i.length){if(i.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(e.length<s.length+r.length)return!1;const l=e.slice(0,s.length),d=r.length===0?[]:e.slice(-r.length),$=e.slice(s.length,r.length===0?1/0:-r.length);return s.every((h,I)=>g(h,l[I],n))&&r.every((h,I)=>g(h,d[I],n))&&(i.length===0||g(i[0],$,n))}return t.length===e.length&&t.every((l,d)=>g(l,e[d],n))}return Reflect.ownKeys(t).every(s=>{const r=t[s];return(s in e||F(i=r)&&i[k]().matcherType==="optional")&&g(r,e[s],n);var i})}return Object.is(e,t)},A=t=>{var e,n,s;return q(t)?F(t)?(e=(n=(s=t[k]()).getSelectionKeys)==null?void 0:n.call(s))!=null?e:[]:Array.isArray(t)?T(t,A):T(Object.values(t),A):[]},T=(t,e)=>t.reduce((n,s)=>n.concat(e(s)),[]);function p(t){return Object.assign(t,{optional:()=>yt(t),and:e=>a(t,e),or:e=>kt(t,e),select:e=>e===void 0?tt(t):tt(e,t)})}function yt(t){return p({[k]:()=>({match:e=>{let n={};const s=(r,i)=>{n[r]=i};return e===void 0?(A(t).forEach(r=>s(r,void 0)),{matched:!0,selections:n}):{matched:g(t,e,s),selections:n}},getSelectionKeys:()=>A(t),matcherType:"optional"})})}function a(...t){return p({[k]:()=>({match:e=>{let n={};const s=(r,i)=>{n[r]=i};return{matched:t.every(r=>g(r,e,s)),selections:n}},getSelectionKeys:()=>T(t,A),matcherType:"and"})})}function kt(...t){return p({[k]:()=>({match:e=>{let n={};const s=(r,i)=>{n[r]=i};return T(t,A).forEach(r=>s(r,void 0)),{matched:t.some(r=>g(r,e,s)),selections:n}},getSelectionKeys:()=>T(t,A),matcherType:"or"})})}function o(t){return{[k]:()=>({match:e=>({matched:!!t(e)})})}}function tt(...t){const e=typeof t[0]=="string"?t[0]:void 0,n=t.length===2?t[1]:typeof t[0]=="string"?void 0:t[0];return p({[k]:()=>({match:s=>{let r={[e??P]:s};return{matched:n===void 0||g(n,s,(i,l)=>{r[i]=l}),selections:r}},getSelectionKeys:()=>[e??P].concat(n===void 0?[]:A(n))})})}function ot(t){return!0}function f(t){return typeof t=="number"}function E(t){return typeof t=="string"}function b(t){return typeof t=="bigint"}p(o(ot));p(o(ot));const x=t=>Object.assign(p(t),{startsWith:e=>{return x(a(t,(n=e,o(s=>E(s)&&s.startsWith(n)))));var n},endsWith:e=>{return x(a(t,(n=e,o(s=>E(s)&&s.endsWith(n)))));var n},minLength:e=>x(a(t,(n=>o(s=>E(s)&&s.length>=n))(e))),length:e=>x(a(t,(n=>o(s=>E(s)&&s.length===n))(e))),maxLength:e=>x(a(t,(n=>o(s=>E(s)&&s.length<=n))(e))),includes:e=>{return x(a(t,(n=e,o(s=>E(s)&&s.includes(n)))));var n},regex:e=>{return x(a(t,(n=e,o(s=>E(s)&&!!s.match(n)))));var n}});x(o(E));const v=t=>Object.assign(p(t),{between:(e,n)=>v(a(t,((s,r)=>o(i=>f(i)&&s<=i&&r>=i))(e,n))),lt:e=>v(a(t,(n=>o(s=>f(s)&&s<n))(e))),gt:e=>v(a(t,(n=>o(s=>f(s)&&s>n))(e))),lte:e=>v(a(t,(n=>o(s=>f(s)&&s<=n))(e))),gte:e=>v(a(t,(n=>o(s=>f(s)&&s>=n))(e))),int:()=>v(a(t,o(e=>f(e)&&Number.isInteger(e)))),finite:()=>v(a(t,o(e=>f(e)&&Number.isFinite(e)))),positive:()=>v(a(t,o(e=>f(e)&&e>0))),negative:()=>v(a(t,o(e=>f(e)&&e<0)))});v(o(f));const w=t=>Object.assign(p(t),{between:(e,n)=>w(a(t,((s,r)=>o(i=>b(i)&&s<=i&&r>=i))(e,n))),lt:e=>w(a(t,(n=>o(s=>b(s)&&s<n))(e))),gt:e=>w(a(t,(n=>o(s=>b(s)&&s>n))(e))),lte:e=>w(a(t,(n=>o(s=>b(s)&&s<=n))(e))),gte:e=>w(a(t,(n=>o(s=>b(s)&&s>=n))(e))),positive:()=>w(a(t,o(e=>b(e)&&e>0))),negative:()=>w(a(t,o(e=>b(e)&&e<0)))});w(o(b));p(o(function(t){return typeof t=="boolean"}));p(o(function(t){return typeof t=="symbol"}));p(o(function(t){return t==null}));p(o(function(t){return t!=null}));class Et extends Error{constructor(e){let n;try{n=JSON.stringify(e)}catch{n=e}super(`Pattern matching error: no pattern matches value ${n}`),this.input=void 0,this.input=e}}const V={matched:!1,value:void 0};function bt(t){return new U(t,V)}class U{constructor(e,n){this.input=void 0,this.state=void 0,this.input=e,this.state=n}with(...e){if(this.state.matched)return this;const n=e[e.length-1],s=[e[0]];let r;e.length===3&&typeof e[1]=="function"?r=e[1]:e.length>2&&s.push(...e.slice(1,e.length-1));let i=!1,l={};const d=(h,I)=>{i=!0,l[h]=I},$=!s.some(h=>g(h,this.input,d))||r&&!r(this.input)?V:{matched:!0,value:n(i?P in l?l[P]:l:this.input,this.input)};return new U(this.input,$)}when(e,n){if(this.state.matched)return this;const s=!!e(this.input);return new U(this.input,s?{matched:!0,value:n(this.input,this.input)}:V)}otherwise(e){return this.state.matched?this.state.value:e(this.input)}exhaustive(e=xt){return this.state.matched?this.state.value:e(this.input)}run(){return this.exhaustive()}returnType(){return this}narrow(){return this}}function xt(t){throw new Et(t)}const at=t=>u(t)&&["pending","accepted","expired","revoked"].some(e=>e===t),wt=t=>at(t)?t:null,Nt=t=>!u(t.id)||!u(t.email)||!u(t.firstName)||!u(t.lastName)||!u(t.invitedBy)?null:{id:t.id,email:t.email,firstName:t.firstName,lastName:t.lastName,invitedBy:t.invitedBy},At=t=>[t.department??null,t.position??null,t.expiresAt??null,t.createdAt??null,t.acceptedAt??null,t.token??null].every(n=>st(n)),C=t=>t??null,It=(t,e)=>{const n=Nt(t);return!n||!At(t)?null:{...n,department:C(t.department),position:C(t.position),status:e,expiresAt:C(t.expiresAt),createdAt:C(t.createdAt),acceptedAt:C(t.acceptedAt),token:C(t.token)}},St=t=>{if(!j(t))return null;const e=t,n=wt(e.status);return n?It(e,n):null},Ct=t=>{if(!j(t)||!("invitations"in t))return null;const e=t.invitations??null;if(!Array.isArray(e))return null;const n=e.map(St).filter(s=>s!==null);return n.length===e.length?{invitations:n}:null},Lt=t=>{if(!j(t))return null;const e=t;return u(e.token)&&u(e.expiresAt)?{token:e.token,expiresAt:e.expiresAt}:null},Tt=t=>{if(!j(t))return null;const{id:e,status:n,revokedAt:s}=t,r=n??null;return u(e)&&at(r)&&st(s)?{id:e,status:r,revokedAt:s}:null},Bt=t=>{if(!j(t))return null;const e=t;return u(e.id)&&u(e.email)&&u(e.firstName)&&u(e.lastName)?{id:e.id,email:e.email,firstName:e.firstName,lastName:e.lastName}:null},ct=t=>bt(t).with({_tag:"NetworkError"},e=>`Network error: ${e.reason}`).with({_tag:"DecodeError"},e=>`Response decode failed: ${e.reason}`).with({_tag:"ApiError"},e=>e.error==="invalid_payload"?"Payload rejected: check required fields.":e.error==="forbidden"?"Only admin/HR accounts can manage invitations.":`API error ${e.status}: ${e.error}`).exhaustive(),jt=t=>{const e=document.createElement("span");return e.className=`status ${t}`,e.textContent=t,e},M=(t,e,n,s)=>{const r=document.createElement("button");r.type="button",r.className=e,r.textContent=t;const i=r.dataset;return i.action=n,i.token=n.includes("token")?s:void 0,i.id=n==="revoke"?s:void 0,r},Ot=t=>{const e=document.createElement("td");if(t.status!=="pending")return e.textContent="—",e;const n=document.createElement("div");return n.className="stack",t.token&&n.append(M("Copy token","btn-primary","copy-token",t.token),M("Copy link","btn-ghost","copy-link",t.token)),n.append(M("Revoke","btn-danger","revoke",t.id)),e.append(n),e},$t=(t,e)=>{if(!t){e.inviteSuccess.classList.add("hidden");return}e.inviteSuccessToken.textContent=t.token,e.inviteSuccessExpiry.textContent=`Expires at ${R(t.expiresAt)}`,e.inviteSuccess.classList.remove("hidden")},_=(t,e)=>{e.userBadge.textContent=t.me?`${t.me.firstName} ${t.me.lastName}`:"Not authenticated"},X=(t,e)=>{if(t.length===0){e.invitesEmpty.classList.remove("hidden"),e.invitesBody.replaceChildren();return}e.invitesEmpty.classList.add("hidden");const n=t.map(s=>{const r=document.createElement("tr");return r.append(Object.assign(document.createElement("td"),{textContent:s.email}),Object.assign(document.createElement("td"),{textContent:`${s.firstName} ${s.lastName}`}),Object.assign(document.createElement("td"),{textContent:s.department??"—"}),Object.assign(document.createElement("td"),{textContent:s.position??"—"}),(()=>{const i=document.createElement("td");return i.append(jt(s.status)),i})(),Object.assign(document.createElement("td"),{textContent:R(s.expiresAt)}),Object.assign(document.createElement("td"),{textContent:R(s.createdAt)}),Object.assign(document.createElement("td"),{textContent:R(s.acceptedAt)}),Ot(s)),r});e.invitesBody.replaceChildren(...n)},z=(t,e)=>t.filter(n=>{const s=e.status==="all"?!0:n.status===e.status,r=e.email.trim().length===0?!0:n.email.toLowerCase().includes(e.email.toLowerCase());return s&&r}),et=72,c={invitations:[],filters:{status:"all",email:""},latest:null,me:null},G=t=>t instanceof HTMLButtonElement,Rt=t=>t instanceof HTMLFormElement,N=t=>t instanceof HTMLDivElement,Ft=t=>t instanceof HTMLInputElement,Ht=t=>t instanceof HTMLSelectElement,Pt=t=>t instanceof HTMLTableSectionElement,y={inviteSuccess:m("invite-success",N),inviteSuccessToken:m("invite-success-token",N),inviteSuccessExpiry:m("invite-success-expiry",N),invitesBody:m("invites-body",Pt),invitesEmpty:m("invites-empty",N),userBadge:m("user-badge",N)},lt=m("invite-form",Rt),H=m("invite-error",N),K=m("copy-created-token",G),D=m("copy-created-link",G),ut=m("filter-status",Ht),dt=m("filter-email",Ft),W=m("table-error",N),B=m("toast-root",N),Q=t=>typeof t=="object"&&t!==null&&"_tag"in t,Y=(t,e)=>{if(!Q(t)){S(e,"Unexpected error");return}const n=ct(t);S(e,n),L(B,n,"error")},mt=t=>{if($t(t,y),t){const e=K.dataset,n=D.dataset;e.token=t.token,n.token=t.token;return}delete K.dataset.token,delete D.dataset.token},Z=()=>O(rt("/api/invitations",Ct)).then(t=>{c.invitations=t.invitations,S(W,null),X(z(c.invitations,c.filters),y)}).catch(t=>{Y(t,W)}),Ut=()=>O(rt("/api/auth/me",Bt)).then(t=>{c.me=t,_(c,y)}).catch(t=>{if(Q(t)&&t._tag==="ApiError"&&t.status===401){c.me=null,_(c,y);return}Y(t,y.userBadge)}),Mt=t=>{const e=t.get("email"),n=t.get("phone"),s=t.get("firstName"),r=t.get("lastName"),i=t.get("departmentId"),l=t.get("positionId"),d=t.get("expiresInHours");if(![e,n,s,r,i,l].every(pt=>u(pt)))return{ok:!1,message:"Please fill every required field."};const h=u(d)?Number.parseInt(d,10):et,I=Number.isFinite(h)&&h>0?h:et;return{ok:!0,payload:{email:e.trim().toLowerCase(),phone:n.trim(),firstName:s.trim(),lastName:r.trim(),departmentId:i.trim(),positionId:l.trim(),expiresInHours:I}}},qt=t=>O(it("/api/invitations",t,Lt)).then(e=>(c.latest=e,mt(c.latest),S(H,null),L(B,"Invitation issued","success"),Z())).catch(e=>{if(Q(e)){const n=ct(e);S(H,n),L(B,n,"error");return}S(H,"Unexpected error")}),Vt=t=>O(it(`/api/invitations/${t}/revoke`,{},Tt)).then(()=>(L(B,"Invitation revoked","success"),Z())).catch(e=>{Y(e,W)}),J=(t,e)=>{const n=ht(vt(()=>navigator.clipboard.writeText(t)),ft(s=>s instanceof Error?s:new Error("copy_failed")));O(n).then(()=>{L(B,`${e} copied`,"success")}).catch(()=>{window.prompt(`Copy ${e}`,t)})},_t=(t,e)=>{if(!u(t)||!u(e)||t!=="copy-token"&&t!=="copy-link")return!1;const n=t==="copy-link"?`${window.location.origin}/register?token=${encodeURIComponent(e)}`:e;return J(n,t==="copy-link"?"Share link":"Token"),!0},Kt=t=>{t.preventDefault();const e=new FormData(lt),n=Mt(e);if(!n.ok){S(H,n.message);return}qt(n.payload)},Dt=t=>{const e=t.target;if(!(e instanceof Element)||!G(e))return;const{action:n,token:s,id:r}=e.dataset;_t(n,s)||n==="revoke"&&u(r)&&Vt(r)},nt=()=>{const t=ut.value,e=t==="all"?"all":t;c.filters={status:e,email:dt.value.trim()},X(z(c.invitations,c.filters),y)},Wt=()=>{lt.addEventListener("submit",Kt),y.invitesBody.addEventListener("click",Dt),ut.addEventListener("change",nt),dt.addEventListener("input",nt),K.addEventListener("click",()=>{c.latest&&J(c.latest.token,"Token")}),D.addEventListener("click",()=>{c.latest&&J(`${window.location.origin}/register?token=${encodeURIComponent(c.latest.token)}`,"Share link")}),Ut(),Z(),mt(c.latest),_(c,y),X(z(c.invitations,c.filters),y)};Wt();
